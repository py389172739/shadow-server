!function(){function _(a){return a.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}function aa(a){var b=document.createElement("a");return b.href=a,""==b.host&&(b.href=b.href),b}function ba(a){var b={},c=a.split("&");return c.forEach(function(a){if(a){var c=a.split("="),d=c[0].trim();d&&(b[d]=(c[1]||"").trim())}}),b}function ca(a,b){var c=null;window.XMLHttpRequest?c=new XMLHttpRequest:window.ActiveXObject&&(c=new ActiveXObject("Microsoft.XMLHTTP")),c&&(c.onreadystatechange=function(){4==c.readyState&&(200==c.status?b(null,c.responseText):b(new Error("XMLHttpRequest failed")),c=null)},c.open("GET",a,!0),c.send(null))}function da(a,b,c){var d=null;if(window.XMLHttpRequest?d=new XMLHttpRequest:window.ActiveXObject&&(d=new ActiveXObject("Microsoft.XMLHTTP")),d){var e=JSON.stringify(b);d.onreadystatechange=function(){4==d.readyState&&(200==d.status?c(null,d.responseText):c(new Error("XMLHttpRequest failed")),d=null)},d.open("POST",a,!0),d.setRequestHeader("Content-Type","application/json; charset=utf-8"),d.send(e)}}function ea(a,b){if(!a.types)return!1;var c,d=a.types.length;for(c=0;c<d;c+=1)if(a.types[c]==b)return!0;return!1}function fa(a){a.stopPropagation()}function ga(a){a.stopPropagation(),a.preventDefault()}function ha(){return L&&"none"!=L.style.display}function qa(a){var b=a.split("/");if(b.length<=2)return null;for(var c,d=b.shift(),e="";c=b.shift();){if("$"!=c[0]||"$"!=c[1]){e+="/"+c;break}e+="/"+c}var f=b.join("/");return f?[d,e,f]:null}function ra(a,b){var c=Array.isArray(a)?sOptid:qa(a+"");if(c){var d=c[0],e=d+c[1],f=c[2];if(!oa.hasOwnProperty(e)){var g="/app/"+e+"/web/TOOL.json";ca(g,function(a,c){if(a)console.log("error: read file failed ("+g+")");else try{var d=JSON.parse(c);oa[e]=!1,Object.keys(d).forEach(function(a){var c=d[a];if(c&&c.name){var e=c.opt||"mono/all";if(oa[c.name]=[e,c.baseUrl,c.tools],f==a&&b){var g=e.split("/");b[0]=g[0],b[1]=g[1]||"all"}}})}catch(a){console.log(a),m.instantShow("error: parse JSON failed ("+g+").")}})}}}function sa(a){for(var b=ja.length-1;b>=0;b-=1)if(ja[b][0]===a){ja.splice(b,1);break}}function ta(){var a="";if(O&&O.parentNode){var b=eb(O);b&&(a=b[0])}var c={viewportX:j,viewportY:k,viewportWd:l,topPanelHi:m.frameInfo.topHi,rightPanelWd:m.frameInfo.rightWd,rootKeyid:V,showPages:"none"!=w.style.display,selected:a};return c}function ua(){if(!ka)return[];try{var a=localStorage.getItem("rewgt/design-bakIndex")||"[]";return JSON.parse(a)}catch(a){return[]}}function va(){for(var a,b=ua(),c=[];a=b[1];)c.push(a[0]),b.splice(1,1);if(c.length)try{c.forEach(function(a){localStorage.removeItem("rewgt/design-bak_"+a)}),localStorage.setItem("rewgt/design-bakIndex",JSON.stringify(b))}catch(a){}}function wa(a,b){var c=b.length,d=Math.min(64,Math.max(3,parseInt(T.cacheSize)||5));d-=1;var e=1048576*d;if(c>e)return void m.instantShow("error: write backup failed (document size should less than "+d+"M).");var f=ua(),g=-1;na&&(g=f.findIndex(function(a){return a[0]==na}),g>=0&&g<f.length-1?g+=1:g=-1);var h=0;f.forEach(function(a,b){(g<0||b<g)&&(h+=a[1])}),h+=c;for(var i=[];h>e&&f.length;){var j=f.shift();i.push(j[0]),h-=j[1]}g-=i.length;try{if(g>=0)for(var j=f[g];j;)i.push(j[0]),f.splice(g,1),j=f[g];f.push([a,c]),i.forEach(function(a){localStorage.removeItem("rewgt/design-bak_"+a)}),localStorage.setItem("rewgt/design-bak_"+a,b),localStorage.setItem("rewgt/design-bakIndex",JSON.stringify(f)),na=0}catch(a){m.instantShow("error: save backup to local storage failed."),console.log("write local storage failed, it's size should large than 5M.")}}function xa(a){try{return localStorage.getItem("rewgt/design-bak_"+a)}catch(a){return null}}function za(){if(!ya&&m.dumpTree){var a=[];if(m.dumpTree(a),1==a.length){ya=!0;var b=(new Date).valueOf()-1e3,c=JSON.stringify({id:b,state:ta(),doc:a[0]});wa(b,c)}}}function Aa(a){function c(){ma=setTimeout(function(){if(ma=0,b+=1,ja.length)if(b>=16){var d=ja[0][1];m.instantShow("warning: can not save backup when system not in idle"+(d?" (still in "+d+")":"")+".")}else a=1e3,c();else{var e=[];if(m.dumpTree(e),1==e.length){var f=(new Date).valueOf(),g=JSON.stringify({id:f,state:ta(),doc:e[0]});wa(f,g)}}},a)}if(ka&&m.dumpTree){ma&&(clearTimeout(ma),ma=0);var b=0;"number"!=typeof a&&(a=3e3),c()}}function Ba(a){if(!ka)return!1;if(ja.length){var b=ja[0][1];return m.instantShow("warning: task ("+a+") ignored when system not in idle"+(b?" (still in "+b+").":".")),!1}return!ma||(m.instantShow("warning: task ("+a+") ignored when pending backup not finished."),!1)}function Ca(){if(Ba("undo")){var a=-1,b=ua();na?(a=b.findIndex(function(a){return a[0]==na}),a>=0&&(a-=1)):a=b.length-2;var c=a>=0?b[a][0]:0;if(!c||c<la)m.instantShow("warning: nothing to undo.");else{var d=xa(c);if(!d)return void m.instantShow("warning: load backup item from local storage failed.");Ea(d),na=c}}}function Da(){if(Ba("redo")){var a=-1,b=ua();if(na&&(a=b.findIndex(function(a){return a[0]==na}),a>=0&&a+1<b.length?a+=1:a=-1),a<0)m.instantShow("warning: nothing to redo.");else{var c=b[a],d=c[0],e=xa(d);if(!e)return void m.instantShow("warning: load backup item from local storage failed.");Ea(e),na=d}}}function Ea(a){function g(){ib(),j=e.viewportX||0,k=e.viewportY||0,l=e.viewportWd||0,m.frameInfo.topHi=e.topPanelHi||0,m.frameInfo.rightWd=e.rightPanelWd||0,m.style.left=j+"px",m.style.top=k+"px",n.style.backgroundPosition=d-14+"px "+(m.frameInfo.topHi+k)+"px",o.style.backgroundPosition=d+j+"px "+(b-28)+"px",o.style.display=m.frameInfo.topHi?"block":"none",p.style.display=m.frameInfo.rightWd?"block":"none",s.style.display=0==j&&0==k?"block":"none",Oa(),e.showPages?(t.style.visibility="visible",w.style.display="block"):(w.style.display="none",t.style.visibility="hidden"),w.innerHTML="",w.style.left="0px",e.rootKeyid?Ha(e.rootKeyid,!1,h):(o.listChildren(""),h())}function h(){var a=e.selected;return a?void(m.getWidgetNode&&m.getWidgetNode(a,"",!1,function(a){gb(a,!1,!1)})):void o.listChildren("")}if(m.loadTree){var c=JSON.parse(a),e=c.state,f=c.doc;O=null,m.loadTree(m,f,function(){m.topmostNode()?g():alert("Restore backup version failed!")})}}function Fa(a,b){"ScenePage"==U&&Ia(V),b&&Xa(b),Aa(a)}function Ga(a,b){var c=!1;if(b)c=!0;else{for(var g,e=0;g=a[e];e++){var h=g[0]+"",i=w.children[e];if(!i||i.getAttribute("keyid")!==h){c=!0;break}}c||a.length==w.children.length||(c=!0)}if(c){w.innerHTML="";var j=u.clientWidth||window.innerWidth-d-80,k=Math.floor(j/f);w.style.width=Math.max((a.length+k-1)*f,20)+"px",a.forEach(function(a){var b=a[0],c=b+"",d=a[1],e=d.getAttribute("name"),f=document.createElement("div");f.setAttribute("style","width:128px; height:100px; background:#fff; margin:2px 4px; float:left; overflow:hidden; outline:red dotted 0px"),f.setAttribute("keyid",c),e&&f.setAttribute("name",e),w.appendChild(f);var g=d.cloneNode(!0);g.style.display="block",g.style.position="static",g.style.width="900px",g.style.height="700px",g.style.transform="scale(0.142)",g.style.transformOrigin="0 0",g.style.zIndex="3006",f.appendChild(g)})}for(var l,e=0;l=w.children[e];e++){var m=l.getAttribute("keyid")==V;l.style.outlineWidth=m?"1px":"0px"}}function Ha(a,b,c){return m.showRootPage?void m.showRootPage(a,function(d){o.listChildren(""),U=d,V=U?a:"";for(var g,e="ScenePage"==d?a:"",f=0;g=w.children[f];f++){var h=g.getAttribute("keyid")==e;g.style.outlineWidth=h?"1px":"0px"}!b||"Panel"!=d&&"Template"!=d||m.getWidgetNode(m.frameInfo.rootName+"."+a,"",!1,function(a){gb(a,!1,!1)}),c&&c()}):void(c&&c())}function Ia(a){if(a){var b=null,c=[];m.listChildren&&(b=m.listChildren("")),b&&(c=b[4]);for(var f,d=null,e=0;f=c[e];e+=1)if(f[0]==a){d=f[1];break}if(d)for(var g,e=0;g=w.children[e];e++)if(g.getAttribute("keyid")==a){sName=d.getAttribute("name"),sName?g.setAttribute("name",sName):g.removeAttribute("name");var h=d.cloneNode(!0);h.style.display="block",h.style.position="static",h.style.width="900px",h.style.height="700px",h.style.transform="scale(0.142)",h.style.transformOrigin="0 0",h.style.zIndex="3006",g.innerHTML="",g.appendChild(h);break}}}function Ja(){var a=0==m.frameInfo.topHi;g=Math.floor(.5*(l?l:window.innerWidth-d-(a?0:c))),h=Math.floor(.5*(window.innerHeight-(a?0:b)-k))}function Ka(){var a=0==m.frameInfo.topHi;q.style.top=(a?0:b)+(h-10)+k+"px",r.style.left=d+(g-10)+j+"px",l?s.style.left=d+l-20+j+"px":s.style.left=window.innerWidth-c-20+"px"}function La(a){function e(a){var b=Object.keys(a),c=[],d={};return b.forEach(function(b){var d,e=a[b];if("object"==e.type)if("default"in e)d=e.default;else{if(!("properties"in e))return;d={};var f=e.properties,g=Object.keys(f);g.forEach(function(a){d[a]=f[a].default})}else d=e.default;c.push([e.propertyOrder||0,b,d])}),c.sort(function(a,b){return a[0]-b[0]}),c.forEach(function(a){d[a[1]]=a[2]}),d}var b=null,c=null,d=null;return[function(f){var g=f.props&&m.widgetSchema(f);return g&&2==g.length?(b=g[0],c=g[1],d=c.wdgtOption,delete c.wdgtOption,[e(c.properties||{}),a,d]):[null,a,null]},function(e,f,g){function l(b,c){var d=a;if(h&&(O=i),b){if(c){var e=eb(c),f=e?e[0]:"";f&&f==a?O=c:d=""}m.notifyBackup(d)}}var h=!1,i=O;if(c&&d&&b&&f[0]){var j=f[1],k=f[2];if(m.saveWdgtProp&&"object"==typeof j&&Array.isArray(k))return h=!0,O=null,k.forEach(function(a){j[a]=void 0}),void m.saveWdgtProp(e,b,d,j,l)}return l(!1,null)}]}function Ma(a){for(var f,b=E.querySelectorAll("img"),c=null,d=0;f=b[d];d++)f.getAttribute("extend")?E.removeChild(f):(f.style.display="none",a&&"uplevel"==f.getAttribute("name")&&(c=f));c?(E.style.width=e+"px",E.style.visibility="visible",c.style.display="inline"):(E.style.width="0px",E.style.visibility="hidden")}function Na(a,b,c){for(var j,f=E.querySelectorAll("img"),g=[],h=[],i=0;j=f[i];i++)if(j.getAttribute("extend"))E.removeChild(j);else{var k=j.getAttribute("name");k&&a[k]?g.push(j):h.push(j)}var l=[];b&&b.forEach(function(a){if(a.clickable){var b,d=a.icon;b=d?"/"==d[0]||0==d.indexOf("http")&&(":"==d[4]||"s:"==d.slice(4,6))?d:c&&"/"!=c.slice(-1)?c+"/"+d:c+d:"/app/files/rewgt/web/res/tools.png";var e=document.createElement("img");e.setAttribute("extend","true"),e.setAttribute("style","display:none; width:16px; height:16px; border:1px solid #f0f0f0; margin:2px;"),e.setAttribute("src",b),a.title&&e.setAttribute("title",a.title),e.setAttribute("draggable","false"),E.appendChild(e),l.push(e),e.onload=function(a){a.target.style.display="inline"},e.onclick=function(b){if(!ha()&&(b.stopPropagation(),O&&O.parentNode&&m.popDesigner)){var d=eb(O);if(d){var e=d[0],f=Object.assign({},a);if(!f.get||!f.set){var g=La(e);f.get=g[0],f.set=g[1]}m.popDesigner(e,f.name,f,c)}}}}}),h.forEach(function(a){a.style.display="none"}),E.style.width=e*(g.length+l.length)+2+"px",g.forEach(function(a){a.style.display="inline"})}function Oa(a){var b,e=window.innerWidth,f=window.innerHeight;if(!(e<d+80+c)){b=l?Math.max(c,e-(d+l+j)):c,Ja(),m.frameInfo.rightWd=0==m.frameInfo.topHi?0:b,m.frameInfo.bottomHi=k,m.refreshFrame&&m.refreshFrame();var g=o.querySelectorAll("td")[2];g&&(g.style.width=b+"px"),p.style.left=e-b+"px",p.style.width=b+"px",y.style.height=f-64+"px";var h=e-d-b;t.style.width=h+"px",u.style.width=h-80+"px",v.style.width=h-80+"px",Ka(),N.style.width=(N.isFull?e-d:e-d-m.frameInfo.rightWd)+"px"}}function Ta(a,b){function q(){A.inScene=e,c?A.style.borderColor=e?"transparent blue blue blue":"transparent red red red":A.style.borderColor=e?"blue":"red",A.style.left=B.left+"px",A.style.top=B.top+"px",A.style.width=Math.max(0,B.width-2)+"px",A.style.height=Math.max(0,B.height-2)+"px",A.style.display="block"}function r(){d?C.style.borderColor="transparent blue blue blue":C.style.borderColor="blue",C.style.left=D.left+"px",C.style.top=D.top+"px",C.style.width=Math.max(0,D.width-2)+"px",C.style.height=Math.max(0,D.height-2)+"px",C.style.display="block"}var c=!1,d=!1,e=!1;if(a){var f,g,h,i;try{f=a.getBoundingClientRect()}catch(a){f=null}if(!f)return;h=Math.min(0,f.top-m.frameInfo.topHi),h<0&&(c=!0,f={left:f.left,top:m.frameInfo.topHi,width:f.width,height:f.height+h});var j=!1;if(Va.length){var k=Va[Va.length-1][2];try{g=k.getBoundingClientRect(),j=!0}catch(a){}j&&(i=Math.min(0,g.top-m.frameInfo.topHi),i<0&&(d=!0,g={left:g.left,top:m.frameInfo.topHi,width:g.width,height:g.height+i}))}var l=!1;j?l=D.left!=g.left||D.top!=g.top||D.width!=g.width||D.height!=g.height:(C.style.display="none",D={left:0,top:0,width:0,height:0});var n=(new Date).valueOf();(j&&O!==a||l)&&(Ra&&(clearTimeout(Ra),Ra=0),D=g,O!==a&&(Sa=0),n-Sa>2e3?r():(C.style.display="none",Ra=setTimeout(r,800)),Sa=n);var o=!1,p=B.left!=f.left||B.top!=f.top||B.width!=f.width||B.height!=f.height;(O!==a||p)&&(Pa&&(clearTimeout(Pa),Pa=0),B=f,O!==a&&(Qa=0,O=a,P+=1,o=!0),b?(e=3==b.length&&"ScenePage"==b[1][0],A.isSceneWdgt=e):e=A.isSceneWdgt,n-Qa>2e3?q():(A.style.display="none",Pa=setTimeout(q,800)),Qa=n,o&&Za(b)),!o&&b&&setTimeout(function(){X.select()},0)}else O&&(C.style.display="none",A.style.display="none",O=null,G.innerHTML="",Za(null))}function Xa(a){if(O&&O.parentNode&&m.widgetSchema){var b=eb(O);if(b){var c=b[0],d=Ya(b[2]);a&&c!=a||d<2&&(b=m.widgetSchema(c,!0),b&&y.setPropEditor(b[0],b[1],b[2],b[3]))}}}function Ya(a){for(var b=0,c=a.length-2;c>=0;){var d=a[c];if(c-=1,d[3])return 2;var e=d[0];if("Template"==e||"ScenePage"==e){for(;c>=0;){var f=a[c];if(c-=1,f[3]){b=2;break}}return b}var g,h=d[2];if(h&&(g=h[1]))if("some"==g)b=1;else if("none"==g)return 2}return b}function Za(a){function b(){for(var a=!!m.hideTemplate;item=Va.pop();)a&&m.hideTemplate(item[1],!0)}if(m.setSceneCurrent){var c=[],d=!1;if(Ua.length)if(!a||a.length<=2||"ScenePage"!=a[1][0])c.push([Ua[0],""]),Ua=[],d=!0;else{Ua[0]!=a[1][1]&&(d=!0,c.push([Ua[0],""]));var e=a[1][1],f=a[2][1];Ua[0]==e&&Ua[1]==f||(d=!0),Ua=[e,f],c.push(Ua)}else a&&a.length>2&&"ScenePage"==a[1][0]&&(Ua=[a[1][1],a[2][1]],d=!0,c.push(Ua));c.length&&m.setSceneCurrent(c),d&&setTimeout(function(){"ScenePage"==U&&Ia(V)},300)}if(!O)return b(),Wa=[],y.setPropEditor(0,null,null),Q=!1,void(R=!1);if(a){b(),Wa=[];var g=!!m.showTemplate,h=a.length-1,i="",j=!1,k=!1;a.forEach(function(a,b){i&&(i+="."),i+=a[1];var c=a[0],d=a[2],e=a[3];e&&(Wa.push(e),b==h&&(j=!0)),"Template"==c&&d&&(Va.push(d),g&&m.showTemplate(d[1],!0),b==h&&(k=!0))});var l=Ya(a);if(l>=2)Ma(!0),y.setPropEditor(0,null,null);else{var n=!1;if(i&&m.widgetSchema){var o=m.widgetSchema(i,!0);if(o){var p=o[2];n=m.beTextable(O.children.length,p.name,p.flag),y.setPropEditor(o[0],o[1],p,o[3])}}var q=a.length>=2?a[1][0]:"",r={copy:1},s=null,t="";1!=l&&(r.move=1),j&&(r.linker=1,r.styles=1),n&&(r.edit_txt=1),(a.length>2||2==a.length&&("Panel"==q||"ScenePage"==q))&&(r.uplevel=1),3==a.length&&"ScenePage"==a[1][0]&&(r.up=1,r.down=1);var u=0,v=O.getAttribute("data-group.optid");if(v){var o=oa[v];o?(t=o[1]||"",s=o[2]):u=1e3}setTimeout(function(){if(u){var a=oa[v];a&&(t=a[1]||"",s=a[2])}if(!s&&i&&m.getGroupOpt){var b=m.getGroupOpt(i);b&&(t=b.baseUrl||"",s=b.tools||[])}Na(r,s,t)},u)}Cb(i)}Q=!!O.style.width,R=!!O.style.height}function db(a){for(var c,b=0;c=a[b];b++){var d=c[3];if(d&&b<a.length-1)return!0}return!1}function eb(a,b){var c=m.children[0];if(!c)return null;for(var d=[],e=[],f=!1,g=null,h="";a;){if(a===c){f=!0,b&&b.unshift(a),d.unshift(["Panel",m.frameInfo.rootName,["mono","all"]]),h=m.frameInfo.rootName+h,e.forEach(function(a){a[1]=m.frameInfo.rootName+a[1]});break}var i=pa(a);if(i){var j=[],k=!1;if(a.classList.contains("rewgt-panel")?j.push("Panel"):a.classList.contains("rewgt-unit")?j.push("Unit"):a.classList.contains("rewgt-inline")&&(j.push("Span"),k=!0),j.length){g||(g=a);var l=k?"data-span.path":"data-unit.path";if(a.hasAttribute(l)||(l=""),j.push(i),a.hasAttribute("data-temp.type")){var n=a.getAttribute("data-temp.type"),o=[n,"",a];e.push(o),j.push(o),j[0]="Template"}else if(a.classList.contains("rewgt-scene")){var o=[a.getAttribute("name")||"","",a];e.push(o),j.push(o),j[0]="ScenePage"}else{var p=a.getAttribute("data-group.opt")||"",q=p.split("/"),r=null,s=[],t=a.getAttribute("data-group.optid");if(t){var o=oa[t];o?(r=o[2],p=o[0]+"",q=p.split("/")):ra(t,s)}s[0]=q[0]||"mono",s[1]=q[1]||"all",Array.isArray(r)&&s.push(r),j.push(s)}if(l){var u=a.getAttribute(l),v=[u,"",a];e.push(v),j.push(v)}b&&b.unshift(a),d.unshift(j),h="."+i+h,e.forEach(function(a){a[1]="."+i+a[1]})}}a=a.parentNode}return f&&g?[h,g,d]:null}function fb(){if("0px"!=E.style.width){_a+=1;var a=_a;E.style.visibility="visible",$a=setTimeout(function(){a==_a&&(E.style.visibility="hidden",$a=0)},4e3)}}function gb(a,b,c){if(!a)return null;var d=eb(a);if(d&&d.length>=2){if(b&&2==d.length&&"Panel"!=d[1][0])return d;var e=d[0],f=d[1],g=d[2];Ta(f,g),o.setWidgetInfo(g),o.listChildren(e),c&&fb()}return d}function hb(){I.style.display="none",Ta(null,null),o.setWidgetInfo(null),o.listChildren(""),Y=0,X.value=""}function ib(){O=null,U="",V="",Ua=[],Va=[],Wa=[],bb=!1,ab=0,cb=!1,sb=!1,wb=!1,xb=!1,Q=!1,R=!1,Z=null,$=0,I.style.display="none",C.style.display="none",A.style.display="none",m.style.zIndex="3000",K.style.display="none",L.style.display="none",M.style.display="none",G.innerHTML="",H.innerHTML="",H.isSceneWdgt=!1}function Cb(a){var b=Array.isArray(a);b&&(Z=null),m.dumpWidget&&setTimeout(function(){Y=1,m.dumpWidget(a,function(b,c){b&&($=P,Z=a,Y=2,X.value=c,X.select())})},0)}function Db(a){function i(a,b){for(var d,c=1;d=I.children[c];c+=1){var e=d.getBoundingClientRect();if(a>=e.left&&a<e.left+e.width&&b>=e.top&&b<e.top+e.height)return!0}return!1}function j(a,c){if(a>d){if(m&&0==m.frameInfo.topHi)return!0;if(c>b)return!0}return!1}if(bb=!1,ab=0,!ha()){var c=a.clientX,e=a.clientY;if(j(c,e)){var f=document.body.style.cursor;if(O&&f&&("ew-resize"==f?ab=1:"ns-resize"==f?ab=2:"nwse-resize"==f&&(ab=3)),rb=!1,vb=!1,yb=!1,jb=!1,bb=!1,ab)pb=c,qb=e;else if(!a.shiftKey&&"ScenePage"==U){var g=!1;if(!O||O.classList.contains("rewgt-scene")){if("block"==I.style.display&&I.children.length>1&&i(c,e)?(vb=!0,multiWdgtMoved_=!1,Ab=c,Bb=e):rb=!0,rb)for(tb=c,ub=e;I.children.length>1;)I.removeChild(I.children[1]);document.body.style.cursor="default"}else{var h=O.getBoundingClientRect();if(c>=h.left&&c<h.left+h.width&&e>=h.top&&e<h.top+h.height)g=!0,jb=!0,ob=!1,lb=c,mb=e;else{for(rb=!0,tb=c,ub=e;I.children.length>1;)I.removeChild(I.children[1]);document.body.style.cursor="default"}}g||a.preventDefault()}}}}function Eb(a,b,c){for(var f,d=[a],e=1;f=I.children[e];e+=1){var g=f.getAttribute("keyid");g&&d.push(g)}if(!(d.length<=1)&&m.moveSceneWdgt){za(),d=m.moveSceneWdgt(d,b,c);for(var f,e=1;f=I.children[e];e+=1){var g=f.getAttribute("keyid");g&&d.indexOf(g)>=0&&(b&&(f.style.left=parseFloat(f.style.left)+b+"px"),c&&(f.style.top=parseFloat(f.style.top)+c+"px"))}Fa(3e3,"")}}function Fb(a){if(!(ha()||m.splitterMouseDn&&m.splitterMouseDn())){var b="default",c=a.clientX,d=a.clientY;if(rb){if(m.selectMultWdgt){for(;I.children.length>1;)I.removeChild(I.children[1]);var e=Math.min(c,tb),f=Math.min(d,ub),g=Math.max(c,tb),h=Math.max(d,ub),i=I.children[0];i?i.style.display="block":(i=document.createElement("div"),i.setAttribute("style","position:absolute; border:1px dotted red; left:0px; top:0px; width:0px; height:0px;"),I.appendChild(i)),i.style.left=e+"px",i.style.top=f+"px",i.style.width=Math.max(0,g-e-2)+"px",i.style.height=Math.max(0,h-f-2)+"px";var j=m.selectMultWdgt(V,tb,ub,c,d);j.forEach(function(a){var b=a[0],c=a[1],d=a[2],e=a[3],f=a[4],g=document.createElement("div");g.setAttribute("keyid",b),g.setAttribute("style","position:absolute; border:1px dotted red; left:"+c+"px; top:"+d+"px; width:"+Math.max(0,e-2)+"px; height:"+Math.max(0,f-2)+"px;"),I.appendChild(g)}),I.style.display="block",P+=1}}else{if(vb&&(yb||(Math.abs(c-Ab)>=4||Math.abs(d-Bb)>=4)&&(vb=!1,yb=!0,zb=ia+=1,ja.push([zb,"moving widget"]))),yb){var k=c-Ab,l=d-Bb;return void(0==k&&0==l||(multiWdgtMoved_||(multiWdgtMoved_=!0,za()),Ab=c,Bb=d,Eb(V,k,l)))}if(!O||!O.parentNode)return void(document.body.style.cursor=b);var n=O.getBoundingClientRect(),o=Math.min(0,n.top-m.frameInfo.topHi);if(o<0&&(n={left:n.left,top:m.frameInfo.topHi,width:n.width,height:n.height+o}),c>=n.left&&c<n.left+n.width&&d>=n.top&&d<n.top+n.height&&($a&&(clearTimeout($a),$a=0),bb||"none"!=I.style.display||fb(),c>=n.left+n.width-6?d>=n.top+n.height-6?Q?b=R?"nwse-resize":"ew-resize":R&&(b="ns-resize"):Q&&(b="ew-resize"):d>=n.top+n.height-6&&R&&(b="ns-resize"),A.inScene&&!bb&&jb&&"default"==b&&"none"!=A.style.display&&m.splitterMouseDn&&!m.splitterMouseDn()&&(Math.abs(c-lb)>=4||Math.abs(d-mb)>=4))){var j=eb(O);j&&(E.style.visibility="hidden",nb=j[0],ob=!1,bb=!0,jb=!1,kb=ia+=1,ja.push([kb,"moving widget"]))}if(bb){ab=0,document.body.style.cursor="default";var k=c-lb,l=d-mb;(k||l)&&(lb=c,mb=d,ob||(ob=!0,za()),m.moveSceneWdgt(nb,k,l),k&&(A.style.left=parseInt(A.style.left)+k+"px"),l&&(A.style.top=parseInt(A.style.top)+l+"px"))}else document.body.style.cursor=b}}}function Gb(a){if(!(ha()||m.splitterMouseDn&&m.splitterMouseDn())){if(sb=!1,I.children.length<=1)I.style.display="none";else{if(rb&&(sb=!0,setTimeout(function(){sb=!1},1e3),"ScenePage"==U&&V)){for(var d,b=[V],c=1;d=I.children[c];c+=1){var e=d.getAttribute("keyid");e&&b.push(e)}if(b.length>1)if(2==b.length&&m.getWidgetNode){var f=m.frameInfo.rootName+"."+V+"."+b[1];setTimeout(function(){m.getWidgetNode(f,"",!1,function(a){a&&(I.style.display="none",gb(a,!1,!1))})},300)}else Ta(null,null),Cb(b)}I.children[0].style.display="none",E.style.visibility="hidden"}if(rb=!1,vb=!1,wb=!1,yb&&(yb=!1,sa(zb),multiWdgtMoved_&&(wb=!0,setTimeout(function(){wb=!1},1e3),multiWdgtMoved_=!1,Fa(3e3,""))),jb=!1,xb=!1,bb)bb=!1,sa(kb),ob&&nb&&(xb=!0,setTimeout(function(){xb=!1},1e3),ob=!1,Fa(3e3,nb));else if(O&&ab){cb=!0,setTimeout(function(){cb=!1},1e3);var g=a.clientX-pb,h=a.clientY-qb,i=!1;if(1!=ab&&3!=ab||0==g||(i=!0),2!=ab&&3!=ab||0==h||(i=!0),i&&m.resizeWidget){var j=eb(O);if(j&&!db(j[2])){var k=j[0];za(),m.resizeWidget(k,ab,g,h,function(a){a&&Fa(3e3,k)})}}}ab=0}}var a="0.0.2",b=116,c=220,d=40,e=22,f=136,g=450,h=350,i="",j=0,k=0,l=0,m=null,n=null,o=null,p=null,q=null,r=null,s=null,t=null,u=null,v=null,w=null,x=null,y=null,z=null,A=null,B={left:0,top:0,width:0,height:0},C=null,D={left:0,top:0,width:0,height:0},E=null,F=null,G=null,H=null,I=null,J=null,K=null,L=null,M=null,N=null,O=null,P=0,Q=!1,R=!1,S="",T={},U="",V="",X=null,Y=0,Z=null,$=0,ia=0,ja=[],ka=!!window.localStorage,la=(new Date).valueOf()-1e3,ma=0,na=0,oa={},pa=function(a){return""},ya=!1,Pa=0,Qa=0,Ra=0,Sa=0,Ua=[],Va=[],Wa=[],$a=0,_a=0,ab=0,bb=!1,cb=!1,jb=!1,kb=0,lb=0,mb=0,nb="",ob=!1,pb=0,qb=0,rb=!1,sb=!1,tb=0,ub=0,vb=!1,wb=!1,xb=!1,yb=!1,zb=0,Ab=0,Bb=0;window.addEventListener("load",function(B){function Ia(a,b,c,d,e,f,g){if(m.copyWidget){var h=O,i=!1;h&&h.parentNode&&(O=null,i=!0),za(),m.copyWidget(a,b,c,d,e,f,function(a,b){if(a){var c="";if(b)if(b.parentNode.parentNode===m&&"absolute"==b.style.position)hb();else if(i){var d=eb(b);d&&(c=d[0]),gb(b,!1,!1)}Fa(300,c)}else i&&(O=h);g&&g(a)})}}function Va(a){var b=a.target;"DIV"==b.nodeName&&(b.style.opacity="0.7")}function Wa(a){var b=a.target;"DIV"==b.nodeName&&(b.style.opacity="1")}function Xa(a){a.stopPropagation();var b=Math.floor(u.clientWidth/f);if(!(b<=0)){var c=Math.max(0,0-w.offsetLeft),d=Math.floor(c/f),e=w.children.length,g=a.target.getAttribute("name");"prev_page"==g?d>=b?w.style.left=0-c+b*f+"px":d>0&&(w.style.left="0px"):"next_page"==g?e>d+b&&(w.style.left=0-c-b*f+"px"):"prev_item"==g?d>0&&(w.style.left=0-f*(d-1)+"px"):"next_item"==g&&d+1<e&&(w.style.left=0-f*(d+1)+"px")}}function fb(a,b,c,d,e,f){function i(){var c=g.widget,h=g.name||"";if(Array.isArray(c)){"/"==h[0]&&(h=h.slice(1));var i=qa(h);i?ra(i,null):h="",za(),a&&(c=g.scene||c),m.createWidget(c,h,b,d,e,f,function(a,b){a&&(b&&b.classList.contains("rewgt-scene")?(hb(),"visible"!=t.style.visibility&&m.instantShow("create ScenePage successful.")):b&&b.parentNode.parentNode===m&&b.getAttribute("data-temp.type")?hb():gb(b,!0,!1),Fa(300,""))})}}if(m.createWidget){var g=c.option;if("object"!=typeof g){if(void 0===g&&c.dragUrl){var h=c.dragUrl+".json";ca(h,function(a,b){if(a)m.instantShow("error: read JSON failed ("+h+")."),console.log(a);else{try{g=JSON.parse(b)}catch(a){console.log(a),m.instantShow("error: parse JSON failed ("+h+").")}g&&g.name&&i()}})}}else g.name&&i()}}function jb(a){if(ea(a.dataTransfer,"application/json"))a.preventDefault();else{if(!Q)return;Q!==F&&Q.parentNode!==E||a.preventDefault()}}function kb(a){a.stopPropagation(),a.preventDefault();var b=H.textContent;if(b){var c=!!a.shiftKey||a.target===Ra,d=20-j-g,e=20-k-h;if(ea(a.dataTransfer,"application/json")){var f=null,l=a.dataTransfer.getData("application/json")||"{}";try{f=JSON.parse(l)}catch(a){console.log(a)}if(!f||"template"!=f.dragType&&"image"!=f.dragType)return;var n=!1;if("ScenePage"==U&&V){var o=b.split(".");(3==o.length||!c&&4==o.length)&&(n=!0)}if("image"==f.dragType){var p=f.dragUrl,q=f.clientWidth,r=f.clientHeight;if(!p)return;0==p.indexOf(i)&&p.length>i.length&&(p=p.slice(i.length));var s={src:p},t=["Img",s,3];q&&r&&(s.style={width:q+"px",height:r+"px"}),n&&(t=[["P",{klass:"default-large-small hidden-visible-auto"},2],t]),fb(n,b,{option:{name:"Img",widget:t}},c,d,e)}else fb(n,b,f,c,d,e),F.style.display="none"}else if(Q){var u=a.dataTransfer.getData("text/plain"),v=Q.getAttribute("name");u&&b&&v&&("linker"==v&&m.bindLinker?(za(),m.bindLinker(u,b,function(a){a&&(F.style.display="none",Fa(300,""))})):"copy"!=v&&"move"!=v||Ia(u,b,c,"move"==v,d,e,function(a){a&&(F.style.display="none")}))}}}function Mb(){if(O){var a=O.parentNode;if(a)return O.classList.contains("rewgt-scene")?void(m.resetRootShow?m.resetRootShow(function(){U="",V="",hb()}):hb()):void(gb(a,!1,!1)||O.classList.contains("rewgt-panel")&&"absolute"!=O.style.position&&hb())}}function Wb(){"none"==w.style.display?(Vb&&(Vb=!1,0==w.children.length&&m.topmostNode&&m.topmostNode()&&hb()),t.style.visibility="visible",w.style.display="block"):(w.style.display="none",t.style.visibility="hidden")}function Xb(a){var b=null;if("ScenePage"==U&&V&&"block"==I.style.display&&I.children.length>1){for(var e,c=[V],d=1;e=I.children[d];d+=1){var f=e.getAttribute("keyid");f&&c.push(f)}c.length>1&&(b=c)}else{if(!O||!O.parentNode)return;var g=eb(O);if(g){var h=Ya(g[2]);if(h>=1)return void m.instantShow("remove selected widget disallowed.");b=g[0]}}if(b&&m.removeWidget){if(a&&!confirm("do you want delete selected widget?"))return;za(),m.removeWidget(b,function(a){a&&(hb(),Fa(300,""))})}}function _b(a){if(a)return $b+=1,$b>6?void setTimeout(function(){a()},3e3):void setTimeout(function(){window.W?W.$main&&(W.$main.inRunning?a():_b(a)):_b(a)},500)}var D=0,Q=null,R=null,la=null,ma=null;if(i=document.location.href.split("?")[0],"/"!=i.slice(-1)&&(i=i.slice(0,i.lastIndexOf("/")+1)),S=ba(window.location.search.slice(1)).page||"index.html",m=document.getElementById("react-container")){m.frameInfo?(Object.assign(m.frameInfo,{topHi:b,rightWd:c,bottomHi:0,leftWd:d}),setTimeout(function(){m.refreshFrame&&m.refreshFrame()},1e3)):m.frameInfo={topHi:b,rightWd:c,bottomHi:0,leftWd:d,rootName:".body"},m.classList.add("noselect-txt");var na=m.getAttribute("__design__");if(na&&"0"!=na){m.version=function(){return a},m.instantShow=function(a){if(a&&ma){for(console.log("[MSG]",a);ma.children.length>=5;){var b=ma.children[0];ma.removeChild(b)}var c=window.innerWidth,e=(window.innerHeight,0);c>800?(e=.2*c,c=.6*c):c>400&&(e=.1*c,c=.8*c),ma.style.left=e+"px",ma.style.width=c+"px";var f=document.createElement("p");f.setAttribute("style","width:"+(c-14)+"px; margin:2px; padding:6px; border:1px solid #ccc; background-color:#ffe; line-height:1.4; font-size:14px; color:#222; text-align:center; overflow:hidden; border-radius:3px; transition: all 0.4s ease-out; -o-transition: all 0.4s ease-out; -moz-transition: all 0.4s ease-out; -webkit-transition: all 0.4s ease-out; -ms-transition: all 0.4s ease-out;"),f.innerHTML=_(a),ma.appendChild(f),ma.style.display="block",setTimeout(function(){f&&f.parentNode&&(f.style.borderWidth="0px",f.style.margin="0px",f.style.padding="0px",f.style.height="0px")},1e4)}},Ja(),window.onbeforeunload=function(){return"This is single page application, do you want shift to another page?"},o=document.createElement("div"),o.setAttribute("style","position:absolute; left:0px; top:0px; width:100%; height:"+b+"px; background:#e8e8e8 url(/app/files/rewgt/web/res/ruler_top.png) no-repeat fixed "+(d+j)+"px "+(b-28)+"px; z-index:3006;"),document.body.appendChild(o),n=document.createElement("div"),n.setAttribute("style","position:absolute; left:0px; top:0px; width:"+d+'px; height:100%; background:#e8e8e8 url("/app/files/rewgt/web/res/ruler_left.png") no-repeat fixed '+(d-14)+"px "+(b+k)+"px; z-index:3020;"),document.body.appendChild(n),p=document.createElement("div"),p.setAttribute("style","position:absolute; right:0px; top:0px; width:"+c+"px; height:100%; background-color:#e8e8e8; z-index:3020; overflow:hidden;"),document.body.appendChild(p);var ta=document.createElement("div");ta.setAttribute("style","position:relative; left:3px; top:3px; line-height:1.2; width:100%; height:"+b+"px;"),n.appendChild(ta);var ua=[["Main menu","/app/files/rewgt/web/res/menu.png","menu"],["Show pages/widgets","/app/files/rewgt/web/res/grid.png","thumb"]];ua.forEach(function(a){var b=a[0],c=a[1],d=a[2],e=document.createElement("img");e.setAttribute("style","width:22px; height:22px; border:1px solid #e8e8e8;"),e.setAttribute("src",c),e.setAttribute("title",b),e.setAttribute("name",d),ta.appendChild(e)}),n.addEventListener("mouseover",function(a){var b=a.target;"IMG"==b.nodeName&&(b.style.borderColor="#f8f8f8 #aaa #aaa #f8f8f8")},!1),n.addEventListener("mouseout",function(a){var b=a.target;"IMG"==b.nodeName&&(b.style.borderColor="#e8e8e8")},!1);var wa=document.createElement("div");wa.setAttribute("style","position:relative; left:3px; top:0px; line-height:1.2; width:100%;"),n.appendChild(wa);var ua=[["Switch viewport","/app/files/rewgt/web/res/switch.png","switch"],["Align center","/app/files/rewgt/web/res/align.png","align"],["","",""],["Remove widget","/app/files/rewgt/web/res/delete.png","delete"],["Undo","/app/files/rewgt/web/res/undo.png","undo"],["Redo","/app/files/rewgt/web/res/redo.png","redo"],["","",""],["Save","/app/files/rewgt/web/res/save.png","save"],["Open or create page","/app/files/rewgt/web/res/open.png","open"],["Config","/app/files/rewgt/web/res/config.png","config"]];ua.forEach(function(a){var b=a[0],c=a[1],d=a[2];if(c){var f=document.createElement("img");f.setAttribute("style","width:22px; height:22px; border:1px solid #e8e8e8;"),f.setAttribute("src",c),f.setAttribute("title",b),f.setAttribute("name",d),wa.appendChild(f)}else{var e=document.createElement("div");e.setAttribute("style","width:100%; height:20px;"),wa.appendChild(e)}}),q=document.createElement("div");var xa=b+(h-10)+k;q.setAttribute("style","position:absolute; left:"+(d-11)+"px; top:"+xa+"px; width:9px; height:18px; border:1px solid #aaa; background-color:rgba(192,192,192,0.7); cursor:ns-resize;"),q.setAttribute("title","Drag to move y-axis"),n.appendChild(q);var ya=0,Aa=!1,Ba=!1,Ea=0;q.addEventListener("click",fa,!1),q.addEventListener("mousedown",function(a){a.stopPropagation(),a.preventDefault(),Aa=!0,Ba=!1,ya=a.clientY},!1),document.addEventListener("mousemove",function(a){var c=a.clientY;if(!(c<=20||c>=window.innerHeight-20)&&(!Ba&&Aa&&Math.abs(c-ya)>=4&&(Ea=ia+=1,ja.push([Ea,"moving viewport"]),hb(),Ba=!0,Aa=!1),Ba)){a.stopPropagation(),a.preventDefault();var e=c-ya;0!=e&&(ya=c,k+=e,m.style.top=k+"px",q.style.top=b+(h-10)+k+"px",n.style.backgroundPosition=d-14+"px "+((0==m.frameInfo.topHi?0:b)+k)+"px")}},!1),document.addEventListener("mouseup",function(a){Aa=!1,Ba&&(sa(Ea),Ba=!1,a.stopPropagation(),a.preventDefault(),k+=a.clientY-ya,Ja(),m.style.top=k+"px",q.style.top=b+(h-10)+k+"px",n.style.backgroundPosition=d-14+"px "+((0==m.frameInfo.topHi?0:b)+k)+"px",m.frameInfo.bottomHi=k,m.refreshFrame&&m.refreshFrame())},!1),o.innerHTML='<table style="width:100%; height:100%; border-collapse:collapse; margin:0px; padding:0px; border:0px solid gray; table-layout:auto; overflow:hidden"><tr><td style="width:'+d+'px"></td><td style="vertical-align:top"></td><td style="width:'+c+'px"></td></tr></table>';var Ma=o.querySelectorAll("td")[1],Na=document.createElement("div");
Na.setAttribute("style","width:100%; height:60px; margin:3px 0px 2px 0px; line-height:1.2; background-color:#f4f4f4; overflow-y:auto; border-radius:3px;"),Ma.appendChild(Na);var Pa=document.createElement("div");Pa.setAttribute("style","width:100%; height:28px; overflow:hidden;"),Ma.appendChild(Pa);var Qa=document.createElement("div");Qa.setAttribute("style","width:100%; height:20px;"),Qa.setAttribute("title","Click to unselect widget"),Ma.appendChild(Qa),F=document.createElement("img"),F.setAttribute("draggable","true"),F.setAttribute("style","display:none; position:relative; left:0px; top:3px; width:16px; height:16px; border:1px solid #e8e8e8; margin:0px 6px 0px 0px;"),F.setAttribute("src","/app/files/rewgt/web/res/empty.png"),Pa.appendChild(F),G=document.createElement("span"),G.setAttribute("style","padding:2px 8px 2px 0px; color:#444;"),Pa.appendChild(G),H=document.createElement("span"),H.setAttribute("style","padding:2px 10px 2px 0px; color:#444;"),Pa.appendChild(H);var Ra=document.createElement("img");Ra.setAttribute("style","display:none; position:relative; left:0px; top:2px; width:16px; height:16px;"),Ra.setAttribute("src","/app/files/rewgt/web/res/insert.png"),Pa.appendChild(Ra),t=document.createElement("div");var Sa=window.innerWidth-d-c;t.setAttribute("style","visibility:hidden; position:absolute; left:"+d+"px; top:0px; width:"+Sa+"px; height:"+(b-10)+"px; background-color:#e8e8e8; overflow:hidden;"),o.appendChild(t),t.innerHTML='<div name="prev_page" title="previous page" style="position:absolute; left:1px; top:2px; width:20px; height:102px; background:#ccc"></div><div name="prev_item" title="previous item" style="position:absolute; left:21px; top:2px; width:20px; height:102px; background:#ddd"></div><div name="page_div" style="position:absolute; left:40px; top:0px; width:'+(Sa-80)+'px; height:104px; z-index:3006; overflow:hidden"><div name="page_list" style="display:none; position:relative; left:0px, top:0px; width:20px; height:100%; overflow:hidden"></div></div><div name="page_mask" style="position:absolute; left:40px; top:0px; width:'+(Sa-80)+'px; height:104px; z-index:3006; overflow:hidden"></div><div name="page_tip" style="display:none; position:absolute; z-index:3040; background-color:#ffd; border:1px solid #ddd; font-size:12px; color:#222; line-height:1; padding:4px; box-shadow:0 3px 3px rgba(0,0,0,0.2)"></div><div name="next_item" title="next item" style="position:absolute; right:20px; top:2px; width:20px; height:102px; background:#ddd"></div><div name="next_page" title="next page" style="position:absolute; right:0px; top:2px; width:20px; height:102px; background:#ccc"></div>',u=t.querySelector('div[name="page_div"]'),v=t.querySelector('div[name="page_mask"]'),w=t.querySelector('div[name="page_list"]');var Ua=t.querySelector('div[name="page_tip"]');v.addEventListener("mousedown",ga,!1),v.addEventListener("dragstart",ga,!1),v.addEventListener("dragend",ga,!1),v.addEventListener("dragover",function(a){if(Q&&Q.parentNode===E){var b=Q.getAttribute("name");"copy"!=b&&"move"!=b||a.preventDefault()}},!1),v.addEventListener("drop",function(a){if(a.stopPropagation(),a.preventDefault(),Q){var b=a.dataTransfer.getData("text/plain");if(b&&m.getWidgetNode){var c=Q.getAttribute("name");if("copy"==c||"move"==c){var d=Math.floor(Math.max(0,0-w.offsetLeft)/f),e=v.getBoundingClientRect(),g=Math.max(0,a.clientX-e.left),h=d+Math.floor(g/f),i=w.children[h],j=null,k="",l=i?i.getAttribute("keyid")||"":"";h>0&&(j=w.children[h-1],j&&(k=j.getAttribute("keyid")||"")),m.getWidgetNode(b,"",!1,function(a){if(a&&a.classList.contains("rewgt-scene")){var b=eb(a);if(b){var d=b[0],e=d.split("."),f=e.pop();if("move"==c&&(f==l||f==k))return;var g=!0,h=m.frameInfo.rootName;l&&(g=!1,e.push(l),h=e.join(".")),Ia(d,h,g,"move"==c,0,0)}}})}}}},!1);var Za=0,$a=!1;v.addEventListener("click",function(a){a.stopPropagation(),a.preventDefault(),J.hideMenu();var c=Math.floor(Math.max(0,0-w.offsetLeft)/f),d=v.getBoundingClientRect(),e=Math.max(0,a.clientX-d.left),g=a.clientY,h=c+Math.floor(e/f),i=w.children[h];if(i){var j=i.getAttribute("keyid")||"",k=i.getAttribute("name");j=k?j+": "+k:j,j&&(Za&&(clearTimeout(Za),Za=0,Ua.style.display="none"),setTimeout(function(){$a||(Ua.style.left=e+40+2+"px",Ua.style.top=Math.min(b-36,g+20)+"px",Ua.innerHTML=_(j),Ua.style.display="block",Za=setTimeout(function(){Ua.style.display="none",Za=0},3e3))},500))}},!1),v.addEventListener("dblclick",function(a){a.stopPropagation(),a.preventDefault(),$a=!0,setTimeout(function(){$a=!1},1e3);var b=Math.floor(Math.max(0,0-w.offsetLeft)/f),c=v.getBoundingClientRect(),d=Math.max(0,a.clientX-c.left),e=b+Math.floor(d/f),g=w.children[e];if(g){var h=g.getAttribute("keyid");h&&Ha(h,!1)}},!1);for(var db,_a=0;db=t.children[_a];_a++)0!=(db.getAttribute("name")||"").indexOf("page_")&&(db.addEventListener("mouseover",Va,!1),db.addEventListener("mouseout",Wa,!1),db.addEventListener("click",Xa,!1));F.addEventListener("mouseover",function(a){var b=a.target;"IMG"==b.nodeName&&(b.style.borderColor="#f8f8f8 #aaa #aaa #f8f8f8")},!1),F.addEventListener("mouseout",function(a){var b=a.target;"IMG"==b.nodeName&&(b.style.borderColor="#e8e8e8")},!1),F.addEventListener("click",fa,!1),F.addEventListener("dblclick",function(a){a.stopPropagation(),F.style.display="none"},!1),F.addEventListener("dragstart",function(a){var b=F.getAttribute("title");b&&(D=ia+=1,ja.push([D,"dragging widget"]),Q=F,a.dataTransfer.setData("text/plain",b))},!1),F.addEventListener("dragend",function(a){sa(D),Q=null,R.selectedInfo=null,R.style.display="none"},!1),G.addEventListener("click",fa,!1),H.addEventListener("click",function(a){a.stopPropagation();var b=a.target;if("SPAN"==b.nodeName){var c=b.getAttribute("title"),d=b.getAttribute("path");c&&d&&m.getWidgetNode&&m.getWidgetNode(c,d,!0,function(a){gb(a,!1,!1)})}},!1),G.addEventListener("mousedown",fa,!1),G.addEventListener("mousemove",fa,!1),G.addEventListener("mouseup",fa,!1),H.addEventListener("mousedown",fa,!1),H.addEventListener("mousemove",fa,!1),H.addEventListener("mouseup",fa,!1);var ib=0;Pa.addEventListener("dragover",function(a){ib&&clearTimeout(ib);var b=Q&&"linker"==Q.getAttribute("name");ib=setTimeout(function(){H.style.backgroundColor="",Ra.style.display="none",ib=0},1e3),H.style.backgroundColor="#f8f8f8",Ra.style.display=b?"none":"inline"},!1),H.addEventListener("dragover",jb,!1),H.addEventListener("drop",kb,!1),Ra.addEventListener("dragover",jb,!1),Ra.addEventListener("drop",kb,!1),o.setWidgetInfo=function(a){var b="";a&&a.forEach(function(a,c){var d=a[0],e=a[1],f=a[2],g=a[3];if(c>0&&(e="."+e),"Template"==d&&f)b+='<span style="color:blue">'+_(e)+"</span>";else if(g){var h=g[0],i=g[1];b+=h&&i?'<span title="'+_(h)+'" path="'+_(i)+'" style="color:blue; text-decoration:underline">'+_(e)+"</span>":_(e)}else b+=_(e)}),H.innerHTML=b,H.isSceneWdgt=a&&3==a.length&&"ScenePage"==a[1][0]},o.listChildren=function(a){var b="",c=["","#a00",-1,[],[]];m.listChildren&&(c=m.listChildren(a));var d=c[0],e=c[1],f=c[2],g=c[3],h=c[4];g.forEach(function(a,c){b+=c==f?'<button style="color:'+e+'">':"<button>",b+=_(a)+"</button>"}),Na.innerHTML=b,d=a?d.replace(/</g,"").replace(/>/g,""):"",G.setAttribute("wdgt_name",d),G.innerHTML=d?"<b>"+_(d)+"</b>:":"",a||Ga(h,!1)},Na.addEventListener("click",function(a){var b=a.target;if("BUTTON"==b.nodeName){a.stopPropagation(),J.hideMenu();var c=b.textContent;if(c){if(!O)return void Ha(c,!0);if(m.getWidgetNode){var d=eb(O);if(d){var e=d[0],f=d[2];m.getWidgetNode(c,e,!1,function(a,b){if(a)if(b){var d=2==f.length&&"ScenePage"==f[1][0];F.setAttribute("src","/app/files/rewgt/web/res/linker.png"),F.setAttribute("name","linker"),F.setAttribute("title",e+"."+c),F.isSceneWdgt=d,F.style.display="inline"}else gb(a,!1,!0)})}}}}},!1),r=document.createElement("div");var lb=d+(g-10)+j;r.setAttribute("style","position:absolute; left:"+lb+"px; top:"+(b-11)+"px; width:18px; height:9px; border:1px solid #aaa; background-color:rgba(192,192,192,0.7); cursor:ew-resize;"),r.setAttribute("title","Drag to move x-axis"),o.appendChild(r);var mb=0,nb=!1,ob=!1,pb=0;r.addEventListener("click",fa,!1),r.addEventListener("mousedown",function(a){a.stopPropagation(),a.preventDefault(),nb=!0,ob=!1,mb=a.clientX},!1),document.addEventListener("mousemove",function(a){var e=a.clientX;if(!(e<=d+20||e>=window.innerWidth-c-30)&&(!ob&&nb&&Math.abs(e-mb)>=4&&(pb=ia+=1,ja.push([pb,"moving viewport"]),hb(),ob=!0,nb=!1),ob)){a.stopPropagation(),a.preventDefault();var f=e-mb;0!=f&&(mb=e,j+=f,m.style.left=j+"px",o.style.backgroundPosition=d+j+"px "+(b-28)+"px",Ka())}},!1),document.addEventListener("mouseup",function(a){if(nb=!1,ob){sa(pb),ob=!1,a.stopPropagation(),a.preventDefault();var e=a.clientX;if(e<=d+20||e>=window.innerWidth-c-30)return;var f=e-mb;0!=f&&(j+=f,m.style.left=j+"px",o.style.backgroundPosition=d+j+"px "+(b-28)+"px",Ka()),s.style.display=0==j?"block":"none"}},!1),s=document.createElement("div");var qb=l?"left:"+(d+l-20+j)+"px":"left:"+(window.innerWidth-c-20)+"px";s.setAttribute("style","position:absolute; "+qb+"; top:"+(b-11)+"px; width:18px; height:9px; border:1px solid #aaa; background-color:rgba(192,192,255,0.7); cursor:ew-resize;"),s.setAttribute("title","Drag to resize width"),o.appendChild(s);var rb=0,tb=!1,ub=!1,vb=0;s.addEventListener("click",fa,!1),s.addEventListener("mousedown",function(a){a.stopPropagation(),a.preventDefault(),z.style.display="block",tb=!0,ub=!1,rb=a.clientX},!1),document.addEventListener("mousemove",function(a){var b=a.clientX;if(!(b<=d+200||b>=window.innerWidth-c-20)&&(!ub&&tb&&Math.abs(b-rb)>=4&&(vb=ia+=1,ja.push([vb,"resizing viewport"]),hb(),ub=!0,tb=!1),ub)){a.stopPropagation(),a.preventDefault();var e=b-rb;0!=e&&(l||(l=window.innerWidth-d-c),rb=b,l+=e,Oa())}},!1),document.addEventListener("mouseup",function(a){if(tb=!1,z.style.display="none",ub){sa(vb),ub=!1,a.stopPropagation(),a.preventDefault();var b=a.clientX;if(b<=d+200||b>=window.innerWidth-c-20)return;var e=b-rb;0!=e&&(l||(l=window.innerWidth-d-c),l+=e,Oa())}},!1),window.addEventListener("resize",Oa,!1),x=document.createElement("div"),x.setAttribute("style","position:relative; left:2%; top:0px; width:96%; height:60px; margin:4px 0px 0px 0px; line-height:1; background-color:#f4f4f4; overflow-y:auto; border-radius:3px;"),p.appendChild(x),y=document.createElement("div"),y.setAttribute("style","width:100%; height:"+(window.innerHeight-64)+"px;"),p.appendChild(y),z=document.createElement("div"),z.setAttribute("style","display:none; position:absolute; left:0px; top:0px; width:100%; height:100%; z-index:3020;"),p.appendChild(z),x.addEventListener("click",function(a){var b=a.target;"BUTTON"==b.nodeName&&(a.stopPropagation(),b.style.color||y.showPage(b.getAttribute("name")))},!1),y.addPage=function(a,b,c){for(var e,d=0;e=y.children[d];d++)if(e.getAttribute("name")==a)return;var f=document.createElement("button");f.setAttribute("name",a),f.textContent=c||a,x.appendChild(f);var g=document.createElement("div");g.setAttribute("name",a),g.setAttribute("style","display:none; width:100%; height:100%;"),y.appendChild(g);var h=document.createElement("iframe");h.setAttribute("frameborder","no"),h.setAttribute("border","0"),h.setAttribute("style","border:0px solid #ccc; width:100%; height:100%;"),g.appendChild(h),h.setAttribute("src",b)},y.showPage=function(a){for(var c,b=0;c=y.children[b];b++)c.style.display=c.getAttribute("name")==a?"block":"none";for(var d,b=0;d=x.children[b];b++)d.style.color=d.getAttribute("name")==a?"#a00":""},y.rmvPage=function(a){for(var d,b="",c=0;d=y.children[c];c++)if(d.getAttribute("name")==a){"none"!=d.style.display&&(c<y.children.length-1?b=y.children[c+1].getAttribute("name"):c>0&&(b=y.children[c-1].getAttribute("name"))),y.removeChild(d);for(var f,e=0;f=x.children[e];e++)if(f.getAttribute("name")==a){x.removeChild(f);break}break}b&&y.showPage(b)},y.setPropEditor=function(a,b,c,d){var e=y.querySelector('div[name="property"] > iframe');if(e&&e.contentWindow){var f=a&&b&&c?{method:"init",param:[a,b,c,d]}:{method:"clear",param:[]},g="[PROJECT_NAME]"+JSON.stringify(f);e.contentWindow.postMessage(g,"*")}},y.showPropEditor=function(a){var b=y.querySelector('div[name="property"] > iframe');if(b&&b.contentWindow){var c={method:"setVisible",param:[!!a]},d="[PROJECT_NAME]"+JSON.stringify(c);b.contentWindow.postMessage(d,"*")}};for(var Bb,yb=[],zb=!1,Ab=!1,ua=document.querySelectorAll("meta"),_a=0;Bb=ua[_a];_a+=1)if("pinp:template"==Bb.getAttribute("property")){var Hb=Bb.getAttribute("page"),Ib=Bb.getAttribute("content");"property"==Hb?Ib||(zb=!0):"resource"==Hb?Ib||(Ab=!0):Hb&&Ib&&yb.push([Hb,decodeURI(Ib)])}var Jb=aa("./").pathname;"/"!=Jb[0]&&(Jb="/"+Jb);var Kb="/app/files/rewgt/web/list_resource.html?base="+encodeURIComponent(Jb),Lb="";zb||(Lb="property",y.addPage("property","/app/files/rewgt/web/prop_page.html")),Ab||(Lb||(Lb="resource"),y.addPage("resource",Kb)),yb.forEach(function(a){Lb||(Lb=a[0]),y.addPage(a[0]+"",Kb+"&url="+encodeURIComponent(a[1]+""))}),ca("$utils?cmd=get_config",function(a,b){if(!a)try{var c=JSON.parse(b);if("object"==typeof c){T=c;var d=c.resourcePages||[];d.forEach(function(a){Lb||(Lb=a[0]),y.addPage(a[0]+"",Kb+"&url="+encodeURIComponent(a[1]+""))})}}catch(a){}Lb&&y.showPage(Lb)}),window.addEventListener("message",function(a){try{"object"==typeof a&&a.data?(a=a.data,a=JSON.parse(a.slice(14))):a=null}catch(b){a=null,console.log(b)}if("object"==typeof a)if("warning"==a.method)m.instantShow(a.param[0]+"");else if("onDialogLoad"==a.method){var b=N.querySelector("iframe");if(!b||b.messengerOK)return;b.messengerOK=!0,b.initDialog&&b.initDialog()}else if("onDialogExit"==a.method){var c=a.param[0],d=a.param[1];c&&(N.innerHTML="",m.setDialogModal(!1),m.setDesignModal(!1)),d&&(za(),m.saveDesigner&&m.saveDesigner(c,a.param[2],a.param[3]))}else if("saveProp"==a.method)try{if(m.updateWdgtProp){var e=O,f=!1;e&&e.parentNode&&(O=null,f=!0),za(),m.updateWdgtProp(a.param[0],a.param[1],function(a,b){a?(b&&b.classList.contains("rewgt-scene")?hb():f&&(O=b||e),Fa(0,"")):f&&(O=e)})}}catch(a){console.log(a)}else if("dragEnd"==a.method){var g=a.param[0];"template"!=g&&"image"!=g||(R.selectedInfo=null,R.style.display="none")}else if("saveConfigData"==a.method){var c=a.param[0],d=a.param[1],h=a.param[2];c&&(N.innerHTML="",m.setDialogModal(!1),m.setDesignModal(!1)),d&&"object"==typeof h&&da("$utils?cmd=save_config",h,function(a,b){a?(m.instantShow("error: save configure failed"+(b?" ("+b+").":".")),console.log(a)):m.instantShow("save configure successful.")})}else"closeDialog"==a.method&&(N.innerHTML="",m.setDialogModal(!1),m.setDesignModal(!1))},!1),C=document.createElement("div"),C.setAttribute("style","display:none; position:absolute; z-index:3010; pointer-events:none; border:1px dashed blue;"),document.body.appendChild(C),ma=document.createElement("div"),ma.setAttribute("style","display:none; position:absolute; left:0px; top:0px; z-index:6000;"),document.body.appendChild(ma),A=document.createElement("div"),A.setAttribute("style","display:none; position:absolute; z-index:3010; pointer-events:none; border:1px dotted red;"),document.body.appendChild(A);var ua=[["Drag to move, double click to relay","/app/files/rewgt/web/res/move.png","move",!0],["Drag to insert, double click to relay","/app/files/rewgt/web/res/copy.png","copy",!0],["Drag to link, double click to relay","/app/files/rewgt/web/res/linker.png","linker",!0],["Modify child styles","/app/files/rewgt/web/res/styles.png","styles",!1],["Edit text content","/app/files/rewgt/web/res/edit_txt.png","edit_txt",!1],["Select uplevel","/app/files/rewgt/web/res/goup.png","uplevel",!1],["Pop to top","/app/files/rewgt/web/res/up.png","up",!1],["Push to bottom","/app/files/rewgt/web/res/down.png","down",!1]];E=document.createElement("div"),E.setAttribute("name","float-btn"),E.setAttribute("style","position:absolute; visibility:hidden; left:0px; top:-26px; width:"+(ua.length*e+2)+"px; height:22px; border:1px solid #ddd; background-color:#f0f0f0; overflow:hidden; pointer-events:auto;"),A.appendChild(E),ua.forEach(function(a){var b=a[0],c=a[1],d=a[2],e=a[3],f=document.createElement("img");f.setAttribute("style","width:16px; height:16px; border:1px solid #f0f0f0; margin:2px;"),f.setAttribute("src",c),f.setAttribute("title",b),f.setAttribute("name",d),f.setAttribute("draggable",e?"true":"false"),E.appendChild(f)}),E.addEventListener("mousedown",function(a){a.stopPropagation(),"true"!=a.target.getAttribute("draggable")&&a.preventDefault()},!1),E.addEventListener("mouseover",function(a){var b=a.target;"IMG"==b.nodeName&&(b.style.borderColor="#fff #aaa #aaa #fff")},!1),E.addEventListener("mouseout",function(a){var b=a.target;"IMG"==b.nodeName&&(b.style.borderColor="#f0f0f0")},!1),E.addEventListener("click",function(a){function v(a){a&&Fa(1e3,d)}function w(a){var b=a.props&&m.widgetSchema(a);return b&&2==b.length?(e=b[1].wdgtOption||null,[e&&e.linkStyles||null,d,c]):[null,"",""]}function x(a,b,c){function j(a,b){var c=d;if(f&&(O=g),a){if(b){var e=eb(b),h=e?e[0]:"";h&&h==d?O=b:c=""}m.notifyBackup(c)}}var f=!1,g=O,h=b[0],i=b[1];h&&e&&"object"==typeof i&&m.saveCompStyles?(f=!0,O=null,m.saveCompStyles(a,e,i,j)):j(!1,null)}function y(a){return[a.textContent,d,c]}function z(a,b,c){function i(a,b){var c=d;if(e&&(O=f),a){if(b){var g=eb(b),h=g?g[0]:"";h&&h==d?O=b:c=""}m.notifyBackup(c)}}var e=!1,f=O,g=b[0],h=b[1];g&&"string"==typeof h&&m.saveNodeContent?(e=!0,O=null,m.saveNodeContent(d,h,i)):i(!1,null)}if(!ha()){a.stopPropagation();var b=a.target,c="",d="",e=null;if("IMG"==b.nodeName){var f=b.getAttribute("name");if("up"!=f&&"down"!=f||!m.setWdgtZIndex){if("uplevel"==f)Mb();else if("styles"==f&&m.popDesigner){if(O&&O.parentNode){var h=eb(O);if(h){d=h[0],c=G.getAttribute("wdgt_name");var u={name:"default",title:"styles editor",url:"/app/files/rewgt/web/edit_styles.html",halfScreen:!1,clickable:!0,width:.8,height:.8,get:w,set:x};m.popDesigner(d,"default",u,"")}}}else if("edit_txt"==f&&m.popDesigner&&O&&O.parentNode&&0==O.children.length){var h=eb(O);if(h){d=h[0],c=G.getAttribute("wdgt_name");var u={name:"default",title:"text editor",url:"/app/files/rewgt/web/edit_content.html",halfScreen:!0,clickable:!0,width:.8,height:.8,get:y,set:z};m.popDesigner(O,"default",u,"")}}}else{var g=null;if(O&&O.parentNode){var h=eb(O);if(h){var i=h[2];3==i.length&&"ScenePage"==i[1][0]&&(d=h[0],g=i[1][2][2])}}if(!g)return;for(var s,j=[],k=0,l=0,n=null,o=null,p=0,q=0,r=0;s=g.children[r];r++){var t=parseInt(s.style.zIndex)||0;0==r?(k=t,n=s,l=t,o=s):(t>=k&&(k=t,n=s,t>k&&(p=0),p+=1),t<=l&&(l=t,o=s,t<l&&(q=0),q+=1)),j.push([t,s])}if(0==j.length)return;if("up"==f){if(O===n&&1==p)return;za(),m.setWdgtZIndex(d,Math.min(999,k+1),v)}else{if(O===o&&1==q)return;za(),m.setWdgtZIndex(d,Math.max(-999,l-1),v)}}}}},!1),E.addEventListener("dblclick",function(a){if(!ha()){var b=a.target;if("IMG"==b.nodeName&&"true"==b.getAttribute("draggable")){a.stopPropagation();var c=b.getAttribute("src"),d=b.getAttribute("name");c&&(F.setAttribute("src",c),d&&F.setAttribute("name",d),F.setAttribute("title",H.textContent),F.isSceneWdgt=H.isSceneWdgt,F.style.display="inline")}}},!1),E.addEventListener("dragstart",function(a){if(!ha()){var b=H.textContent,c=a.target;b&&"IMG"==c.nodeName&&"true"==c.getAttribute("draggable")&&(D=ia+=1,ja.push([D,"dragging widget"]),Q=c,Q.isSceneWdgt=H.isSceneWdgt,a.dataTransfer.setData("text/plain",b))}},!1),E.addEventListener("dragend",function(a){sa(D),Q=null,R.selectedInfo=null,R.style.display="none"},!1),n.addEventListener("click",function(a){a.stopPropagation(),J.hideMenu(),hb()},!1),o.addEventListener("click",function(a){a.stopPropagation(),J.hideMenu(),hb()},!1),setInterval(function(){if(!bb)try{O&&O.parentNode?Ta(O,null):O&&hb()}catch(a){}},250),document.addEventListener("mousedown",Db,!1),document.addEventListener("mousemove",Fb,!1),document.addEventListener("mouseup",Gb,!1),R=document.createElement("div"),R.setAttribute("style","display:none; position:absolute; z-index:3010; pointer-events:none; border:1px solid red;"),document.body.appendChild(R);var Nb=document.createElement("div");Nb.setAttribute("style","position:absolute; left:0px; top:-24px; width:100px; height:22px; color:#a00;"),R.appendChild(Nb),la=document.createElement("img"),la.setAttribute("style","display:none; position:absolute; right:0px; bottom:0px; width:16px; height:16px;"),la.setAttribute("src","/app/files/rewgt/web/res/insert.png"),R.appendChild(la),ka?va():setTimeout(function(){m.instantShow("warning: undo/redo not supported, your browser has no local storage.")},0),I=document.createElement("div"),I.setAttribute("style","display:none; position:absolute; left:0px; top:0px; z-index:3010; pointer-events:none;"),document.body.appendChild(I),J=document.createElement("ul"),J.setAttribute("style","position:absolute; z-index:3022; display:none; left:30px; top:30px; min-width:60px; background-color:#f4f4f4; border:1px solid #eee; margin:0px; padding:2px; line-height:1.4; border-radius:4px; box-shadow:-2px 4px 4px rgba(0,0,0,0.2); list-style:none; -webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;-o-user-select:none"),J.innerHTML='<li name="list_prj" style="padding:0px 8px">List projects</li><li name="show_doc" style="padding:0px 8px">Online document</li>',document.body.appendChild(J),J.addEventListener("mouseover",function(a){var b=a.target;"LI"==b.nodeName&&(b.style.backgroundColor="blue",b.style.color="white")},!1),J.addEventListener("mouseout",function(a){var b=a.target;"LI"==b.nodeName&&(b.style.backgroundColor="",b.style.color="")},!1),J.addEventListener("click",function(a){a.stopPropagation(),J.style.display="none";var b=a.target;if("LI"==b.nodeName){var c=b.getAttribute("name");if("list_prj"==c)ca("$utils?cmd=list_project",function(a,b){if(a)return void m.instantShow("warning: query project failed.");try{var c=JSON.parse(b);if(Array.isArray(c)){var d={name:"default",title:"list project",url:"/app/files/rewgt/web/list_projects.html",halfScreen:!0,width:.9,height:.9,clickable:!1};m.showDesignDlg(0,d,c,"")}}catch(a){}});else if("show_doc"==c){var d={name:"default",title:"online help",url:"/app/files/rewgt/web/doc/index.html",halfScreen:!1,width:.9,height:.9,clickable:!1};m.showDesignDlg(0,d,{},"")}}},!1),J.showMenu=function(a,b){J.style.left=a+"px",J.style.top=b+"px",J.style.display="block"},J.hideMenu=function(){J.style.display="none"},K=document.createElement("div"),K.setAttribute("style","position:absolute; z-index:3020; display:none; left:0px; top:0px; width:100%; height:100%"),o.appendChild(K),L=document.createElement("div"),L.setAttribute("style","position:absolute; z-index:3020; display:none; left:0px; top:0px; width:100%; height:100%"),n.appendChild(L),M=document.createElement("div"),M.setAttribute("style","position:absolute; z-index:3020; display:none; left:0px; top:0px; width:100%; height:100%"),p.appendChild(M),N=document.createElement("div"),N.isFull=!0,N.setAttribute("style","position:absolute; z-index:3020; display:none; left:"+d+"px; top:0px; width:"+(window.innerWidth-d)+"px; height:100%; overflow:hidden"),document.body.appendChild(N);var Ob=!1,Pb=!1,Qb=null,Rb=null,Sb=0,Tb=0;N.onmouseup=M.onmouseup=L.onmouseup=K.onmouseup=function(a){Pb||a.stopPropagation()},N.addEventListener("mousemove",function(a){if(a.stopPropagation(),Ob&&Qb&&Qb.parentNode&&Rb&&Rb.parentNode){var b=a.clientX-Sb,c=a.clientY-Tb;Pb||(Math.abs(b)>=4||Math.abs(c>=4))&&(Pb=!0),!Pb||0==b&&0==c||(Qb.style.left=Qb.offsetLeft+b+"px",Qb.style.top=Qb.offsetTop+c+"px",Rb.style.left=Rb.offsetLeft+b+"px",Rb.style.top=Rb.offsetTop+c+"px",Sb+=b,Tb+=c)}},!1),document.addEventListener("mouseup",function(a){Ob=!1,Pb=!1,Qb&&Qb.parentNode&&(Qb.style.width="10px",Qb.style.height="10px")},!1),N.ondblclick=M.ondblclick=L.ondblclick=K.ondblclick=ga,N.onmousedown=M.onmousedown=L.onmousedown=K.onmousedown=ga,N.onmousemove=M.onmousemove=L.onmousemove=K.onmousemove=fa,N.onkeypress=M.onkeypress=L.onkeypress=K.onkeypress=ga,N.onkeydown=M.onkeydown=L.onkeydown=K.onkeydown=ga,N.onkeyup=M.onkeyup=L.onkeyup=K.onkeyup=fa,N.ondragover=M.ondragover=L.ondragover=K.ondragover=fa,N.ondrop=M.ondrop=L.ondrop=K.ondrop=fa,m.selectedWidget=function(a){var b=O;return a&&"string"==typeof a.nodeName&&(O=a),b&&b.parentNode?b:null},m.notifyBackup=function(a){Fa(300,a)},m.showDesignDlg=function(a,b,c,e){var f=window.innerWidth-d,g=window.innerHeight;b.halfScreen?(f-=m.frameInfo.rightWd,N.isFull=!1,y.showPropEditor(!1)):N.isFull=!0,N.style.width=f+"px",N.innerHTML="";var h,i=b.url+"";"/"==i[0]||0==i.indexOf("http")&&(":"==i[4]||"s:"==i.slice(4,6))?h=i:(e=e||"",h=e&&"/"!=e.slice(-1)?e+"/"+i:e+i);var l,j=parseFloat(b.left),k=parseFloat(b.top),n=parseFloat(b.width);"number"!=typeof n||n>=.9999&&n<1||n<=0?(n="100%",l=0):n>=1?(l=Math.floor((f-n)/2),n+="px"):(l=Math.floor((1-n)/2*f),"number"==typeof j&&j>0&&j<1&&j<1-n&&(l=Math.floor(j*f)),n=100*n+"%");var o,p=parseFloat(b.height);"number"!=typeof p||p>=.9999&&p<1||p<=0?(p="100%",o=0):p>=1?(o=Math.floor((g-p)/2),p+="px"):(o=Math.floor((1-p)/2*g),"number"==typeof k&&k>0&&k<1&&k<1-p&&(o=Math.floor(k*g)),p=100*p+"%"),Rb=document.createElement("iframe"),Rb.setAttribute("frameborder","no"),Rb.setAttribute("border","0"),Rb.setAttribute("style","position:absolute; border:0px solid #e0e0e0; left:0px; top:0px; width:100%; height:100%;"),Rb.style.left=l+"px",Rb.style.top=o+"px",Rb.style.width=n,Rb.style.height=p;var q=!0;if("100%"!=n&&"100%"!=p&&(q=!1,Rb.style.borderWidth="1px",Rb.style.boxShadow="-2px 8px 4px rgba(0,0,0,0.1)"),Rb.messengerOK=!1,Rb.initDialog=function(){if(Rb.messengerOK&&m.pluginCss)try{var b="[PROJECT_NAME]"+JSON.stringify({method:"init",param:[a,c,m.pluginCss()]});Rb.contentWindow.postMessage(b,"*")}catch(a){console.log(a)}},Rb.exitDialog=function(){if(Rb.messengerOK){var a="[PROJECT_NAME]"+JSON.stringify({method:"close",param:[!0]});Rb.contentWindow.postMessage(a,"*")}else setTimeout(function(){N.innerHTML="",m.setDialogModal(!1),m.setDesignModal(!1)},0)},N.appendChild(Rb),Rb.setAttribute("src","$proxy?url="+encodeURIComponent(h)),!q&&!b.noMove){Qb=document.createElement("div"),Qb.setAttribute("style","position:absolute; left:"+l+"px; top:"+o+"px; width:10px; height:10px;");var r=document.createElement("div");r.setAttribute("style","width:10px; height:10px; background-color:#00d; cursor:move;"),Qb.appendChild(r),N.appendChild(Qb),r.onmousedown=function(a){a.stopPropagation(),a.preventDefault(),Qb&&Qb.parentNode&&(Ob=!0,Pb=!1,Qb.style.width="100%",Qb.style.height="100%",Sb=a.clientX,Tb=a.clientY)}}m.setDialogModal(!0)},m.setDesignModal=function(a){a||m.closeModal(),m.style.zIndex=a?"3012":"3000";var b=a?"block":"none";K.style.display=b,L.style.display=b,M.style.display=b,a||y.showPropEditor(!0)},m.setDialogModal=function(a){var b=a?"block":"none";a||(K.style.display="none",M.style.display="none",m.style.zIndex="3000"),L.style.display=b,N.style.display=b},N.onclick=M.onclick=L.onclick=K.onclick=function(a){a.stopPropagation(),J.hideMenu();var b=a.target;setTimeout(function(){var a=!1,c=null;b!==L&&b!==N||("none"!=N.style.display&&(c=N.querySelector("iframe"),c&&c.exitDialog&&(a=!0)),a||m.setDialogModal(!1)),a?c.exitDialog():m.setDesignModal(!1)},300)};var Ub=!0;m.addEventListener("click",function(a){function r(){if(Ub){var a=q[0],b=q[1],c=q[2];Ta(b,c),o.setWidgetInfo(c),o.listChildren(a),R.style.display="none"}}if(!ha()&&!(ab||cb||sb||wb||xb||m.splitterMouseDn&&m.splitterMouseDn())){J.hideMenu();var b=a.target;if(a.shiftKey){var c=null,d="";if("ScenePage"==U&&V){for(;b&&b!==m;){var e=b.parentNode;if(e&&e.classList.contains("rewgt-center")){var f=e.parentNode;if(f&&f.classList.contains("rewgt-scene")){c=b;break}}b=e}c&&(d=pa(c))}if(d){var g=!1;if("block"==I.style.display&&I.children.length>=1){for(var j,h=!1,i=1;j=I.children[i];i+=1)if(d===j.getAttribute("keyid")){I.removeChild(j),h=!0;break}if(h)I.children.length<=1?I.style.display="none":g=!0;else{var k=c.getBoundingClientRect(),l=document.createElement("div");l.setAttribute("keyid",d),l.setAttribute("style","position:absolute; border:1px dotted red; left:"+k.left+"px; top:"+k.top+"px; width:"+Math.max(0,k.width-2)+"px; height:"+Math.max(0,k.height-2)+"px;"),I.appendChild(l),g=!0}}else if(!O||O.classList.contains("rewgt-scene")){var k=c.getBoundingClientRect(),l=document.createElement("div");l.setAttribute("keyid",d),l.setAttribute("style","position:absolute; border:1px dotted red; left:"+k.left+"px; top:"+k.top+"px; width:"+Math.max(0,k.width-2)+"px; height:"+Math.max(0,k.height-2)+"px;"),I.appendChild(l),I.style.display="block",g=!0}if(g){P+=1;for(var j,n=[V],i=1;j=I.children[i];i+=1){var d=j.getAttribute("keyid");d&&n.push(d)}n.length>1&&Cb(n)}}}else{var p=!1;if(O&&O.parentNode)for(;b&&b!==m;){if(b===O){p=!0;break}b=b.parentNode}I.style.display="none";var q=eb(a.target);q&&(Ub=!0,p?setTimeout(function(){r()},300):r())}}},!1),m.addEventListener("dblclick",function(a){if(!ha()&&!ab&&!cb&&O&&O.parentNode&&m.popDesigner){for(var b=a.target,c=!1;b&&b!==m;){if(b===O){c=!0;break}b=b.parentNode}if(c){var d=eb(O);if(d){Ub=!1;var e=d[0],f=d[2],g=O.getAttribute("data-group.optid"),h=Ya(f);if(h<=1&&g&&g.indexOf("/")>0){var i=oa[g],j=i?i[1]:null;if(Array.isArray(i)&&"string"==typeof j&&(i=i[2])){var k=i.find(function(a){return"default"===a.name});if(k){var l=Object.assign({},k);if(!l.get||!l.set){var n=La(e);l.get=n[0],l.set=n[1]}return void m.popDesigner(e,"default",l,j)}}}if(h<=1&&m.popDesigner(e,"default"))return;if(h>=2)return;var k={name:"default",title:"default editor",url:"/app/files/rewgt/web/edit_prop.html",halfScreen:!0,clickable:!1,width:.9,height:.9},n=La(e);k.get=n[0],k.set=n[1],m.popDesigner(e,"default",k,"")}}}},!1),m.addEventListener("dragover",function(a){if(!ha()){var c,d=!!a.shiftKey,e=!1,f=!1;if(ea(a.dataTransfer,"application/json"))c=!1,e=!0;else{if(!Q)return;if(Q!==F&&Q.parentNode!==E)return;f="linker"==Q.getAttribute("name"),c=Q.isSceneWdgt}var g=[],h=eb(a.target,g);if(h){var i=h[0],j=h[1],k=h[2],l=i.split(".").pop(),m=k.length>=2&&"ScenePage"==k[1][0];if(m&&c&&!d){var n=k[1][2];if(i=n[1],f){if(!(g.length>=3))return;j=g[2],k=k.slice(0,3),l=k[2][1],i=i+"."+l}else j=n[2],k=k.slice(0,2),l=k[1][1]}var o=m&&3==k.length,p=m&&2==k.length,q=!1,r=j.getBoundingClientRect(),s=Math.min(0,r.top-b);s<0&&(q=!0,r={left:r.left,top:b,width:r.width,height:r.height+s}),R.selectedInfo=[i,j,k],R.style.left=r.left+"px",R.style.top=r.top+"px",R.style.width=Math.max(0,r.width-2)+"px",R.style.height=Math.max(0,r.height-2)+"px",q?R.style.borderColor=o?"transparent blue blue blue":"transparent red red red":R.style.borderColor=o?"blue":"red",R.style.display="block",Nb.innerHTML=_(l||""),!f&&r.width>=20&&r.height>=10&&!p?la.style.display="block":la.style.display="none",a.preventDefault()}else R.style.display="none",e&&a.preventDefault()}},!1),m.addEventListener("drop",function(a){a.stopPropagation(),a.preventDefault();var c=!!a.shiftKey,e=a.clientX,f=a.clientY;if(!c&&"none"!=la.style.display){var l=la.getBoundingClientRect();e>=l.left&&e<l.left+l.width&&f>=l.top&&f<l.top+l.height&&(c=!0)}if(e=e-d-j-g,f=f-b-k-h,ea(a.dataTransfer,"application/json")){var n=null,o=a.dataTransfer.getData("application/json")||"{}";try{n=JSON.parse(o)}catch(a){console.log(a)}if(!n||"template"!=n.dragType&&"image"!=n.dragType)return;var p="none"!=R.style.display&&R.selectedInfo,q=p?p[0]:null;if("image"==n.dragType){var r=n.dragUrl,s=n.clientWidth,t=n.clientHeight;if(!r)return;0==r.indexOf(i)&&r.length>i.length&&(r=r.slice(i.length));var u=!1;if("ScenePage"==U&&V){(!q||q.split(".").length<=3)&&(q=m.frameInfo.rootName+"."+V,c=!0);var v=q.split(".");(3==v.length||!c&&4==v.length)&&(u=!0)}var w={src:r},x=["Img",w,3];s&&t&&(w.style={width:s+"px",height:t+"px"}),u&&(x=[["P",{klass:"default-large-small hidden-visible-auto"},2],x]),fb(u,q,{option:{name:"Img",widget:x}},c,e,f)}else{var u=!1;if("ScenePage"==U&&V&&q){var v=q.split(".");(3==v.length||!c&&4==v.length)&&(u=!0)}fb(u,q,n,c,e,f)}}else if(Q){var y=Q.getAttribute("name"),z=a.dataTransfer.getData("text/plain"),p=R.selectedInfo;if(y&&z&&p){var A=p[0];p[1],p[2];"linker"==y&&m.bindLinker?(za(),m.bindLinker(z,A,function(a){
a&&(F.style.display="none",Fa(300,""))})):"copy"!=y&&"move"!=y||Ia(z,A,c,"move"==y,e,f,function(a){a&&(F.style.display="none")})}}},!1),ta.querySelector('img[name="menu"]').onclick=function(a){a.stopPropagation(),J.showMenu(a.clientX,a.clientY)};var Vb=!0;ta.querySelector('img[name="thumb"]').onclick=function(a){a.stopPropagation(),J.hideMenu(),Wb()},wa.querySelector('img[name="switch"]').onclick=function(a){a.stopPropagation(),J.hideMenu(),m.frameInfo.topHi?(m.frameInfo.topHi=0,m.frameInfo.rightWd=0,n.style.backgroundPosition=d-14+"px "+k+"px",o.style.display="none",p.style.display="none"):(m.frameInfo.topHi=b,m.frameInfo.rightWd=c,n.style.backgroundPosition=d-14+"px "+(b+k)+"px",o.style.display="block",p.style.display="block"),Oa()},wa.querySelector('img[name="align"]').onclick=function(a){a.stopPropagation(),J.hideMenu(),0==j&&0==k||(j=0,k=0,s.style.display="block",m.style.left=j+"px",m.style.top=k+"px",n.style.backgroundPosition=d-14+"px "+((0==m.frameInfo.topHi?0:b)+k)+"px",o.style.backgroundPosition=d+j+"px "+(b-28)+"px",Ka(),m.frameInfo.bottomHi=k,m.refreshFrame&&m.refreshFrame())},wa.querySelector('img[name="delete"]').onmousedown=function(a){a.stopPropagation(),a.preventDefault(),J.hideMenu(),Xb(!0)},wa.querySelector('img[name="undo"]').onclick=function(a){a.stopPropagation(),J.hideMenu(),Ca()},wa.querySelector('img[name="redo"]').onclick=function(a){a.stopPropagation(),J.hideMenu(),Da()},wa.querySelector('img[name="save"]').onclick=function(a){if(a.stopPropagation(),J.hideMenu(),m.getDocHtml){var b=m.getDocHtml();if(!b)return void m.instantShow("warning: dump document failed.");var c={page:S,html:b};da("$save?page="+encodeURIComponent(S),c,function(a,b){a?(m.instantShow("error: save document failed"+(b?" ("+b+").":".")),console.log(a)):m.instantShow("save document successful.")})}},wa.querySelector('img[name="open"]').onclick=function(a){a.stopPropagation(),J.hideMenu(),ca("$utils?cmd=list_page",function(a,b){if(a)return void m.instantShow("warning: query HTML file list failed.");try{var c=JSON.parse(b);if(Array.isArray(c)){var d={name:"default",title:"open pages",url:"/app/files/rewgt/web/list_pages.html",halfScreen:!0,width:.9,height:.9,clickable:!1},e=aa("./").href;m.showDesignDlg(0,d,{currProj:e,currFile:S,pages:c},"")}}catch(a){}})},wa.querySelector('img[name="config"]').onclick=function(a){a.stopPropagation(),J.hideMenu();var b={name:"default",title:"edit configure",url:"/app/files/rewgt/web/edit_config.html",halfScreen:!1,width:.8,height:.9,clickable:!1};m.showDesignDlg(0,b,T,"")};var Yb=null,Zb="";X=document.createElement("textarea"),X.setAttribute("style","position:absolute; left:0px; top:0px; width:24px; height:24px; overflow:hidden"),document.body.appendChild(X),X.addEventListener("copy",function(a){Yb=null;var b=2==Y&&X.value;b&&$==P||(a.preventDefault(),b&&$!=P&&m.instantShow("copy selected widget failed."))},!1),X.addEventListener("paste",function(a){var b=Yb;Yb=null,a.preventDefault();for(var f,c=a.clipboardData.types,d="",e=0;f=c[e];e+=1)if("Text"==f||0==f.indexOf("text/")){d=a.clipboardData.getData(f);break}var g="";if(d)if(!O&&"ScenePage"==U&&V)g=m.frameInfo.rootName+"."+V;else if(d&&O&&O.parentNode){var h=eb(O);h&&(g=h[0])}g&&m.pasteWidget&&(b&&(d!==Zb&&(b=null),Zb=""),za(),m.pasteWidget(g,d,b,function(a,b){a&&(m.instantShow(a+" widget(s) pasted."),b&&hb(),Fa(300,""))}))},!1),X.addEventListener("cut",function(a){var b=2==Y&&X.value;if($!=P)return a.preventDefault(),void(b&&m.instantShow("cut selected widget failed."));if(b&&"string"==typeof Z){var c=eb(Z);if(c){var d=Ya(c[2]);if(d>=1)return a.preventDefault(),void m.instantShow("cut selected widget disallowed.")}}b&&(Yb=Z,Zb=X.value)},!1),X.addEventListener("keydown",function(a){var b=a.keyCode;if(!a.ctrlKey&&!a.metaKey||67!=b&&86!=b&&88!=b)if(a.preventDefault(),a.shiftKey){if(37==b)Mb();else if(39==b){if(O&&O.parentNode&&m.firstChildOf){var c=eb(O);if(c){var d=m.firstChildOf(c[0],!0);d&&gb(d,!1,!1)}}}else if(38==b||40==b){var c;if(O&&O.parentNode&&"ScenePage"==U&&V&&m.listPageChild&&(c=eb(O))){var e=c[2],f=e.length>=3?e[2][1]:"",c=m.listPageChild(V);if(c.length){bSort=[],c.forEach(function(a){var b=a[1],c=b.getBoundingClientRect();0==c.width&&0==c.height||bSort.push([c.top,c.left,a[0],b])}),bSort.sort(function(a,b){return a[0]==b[0]?a[1]-b[1]:a[0]-b[0]});var g=null;if(f)for(var i,h=0;i=bSort[h];h+=1)if(i[2]==f){g=38==b?h>0?bSort[h-1][3]:i[3]:h<bSort.length-1?bSort[h+1][3]:i[3];break}g||(g=38==b?bSort[0][3]:bSort[bSort.length-1][3]),gb(g,!1,!1)}}}}else if(a.altKey)if(8==b)Xb(!1);else{var j=0,k=0;if(37==b?j=-1:38==b?k=-1:39==b?j=1:40==b&&(k=1),(j||k)&&"ScenePage"==U&&V)if("block"==I.style.display&&I.children.length>1)Eb(V,j,k);else if(O&&O.parentNode){var c=eb(O);if(c){var l=c[0];za(),c=m.moveSceneWdgt(l,j,k),1==c.length&&(j&&(A.style.left=parseFloat(A.style.left)+j+"px"),k&&(A.style.top=parseFloat(A.style.top)+k+"px"),Fa(3e3,l))}}}},!1);var $b=0;_b(function(){m.onlyScenePage&&m.onlyScenePage()&&Wb(),"object"==typeof W&&W.$main&&(W.$main.inDesign=!0,m.keyOfNode&&(pa=m.keyOfNode))})}}},!1)}();