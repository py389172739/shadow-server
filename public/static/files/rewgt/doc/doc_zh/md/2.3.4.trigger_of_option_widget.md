2.3.4 选项触发器
------------------

&nbsp;

选项构件具有两大功能，其一是前面已介绍的动态切换场景面板，其二是提供选项触发器。在选项构件选中时，触发器将自动触发预定义的动作。

#### 用 popOption 配置浮层弹窗

上一节举例用编程手段弹出浮层窗口，现改用可选构件实现，只用转义标签描述界面，不必借助编程。定义界面如下：

```
  <div :t=Panel key='top'>
    <div :t=NavPanel key='nav' width='{0.9999}' height='{200}'>
      <div :t=Div key='msg' padding='{[0,6]}' style='display:none'>
        <div :t=P>Hello, world!</div>
      </div>

      <div :t=P key='opt'>
        <span :t=OptButton key='btn' pop-option='{{"path":"./msg","width":0.7,"height":200,"bodyStyle":{"display":"block"}}}'>show hello</span>
      </div>
    </div>
  </div>
```

把 popOption 定义移到选项构件 OptButton，用 `popOption.path` 指定弹窗要引用的内容节点，之后点击该选项构件（即 "show hello" 按钮），系统将弹出同等效果的浮层窗口。

当一个选项构件未定义 popOption 属性时，它用作 “场景面板切换器”，但定义 popOption 后，它自动改用作 “浮层弹窗触发器”，切换场景面板与触发弹窗不可并存于同一构件。

#### 使用 trigger 触发器

所有选项构件都可以定义 trigger 双源属性，让构件选中时能自动触发预设动作，比如在上例 "show hello" 按钮之后增设一个按钮：

```
  <span :t=OptButton key='btn2' trigger='["//btn"]'>trigger</span>
```

trigger 取值要求是一个 “可计算表达式” 字串，表达式的计算结果必须是 array 数组，数组给出一个或多个预设的动作，包作：

1. 用 `sPath` 指出目标节点，目标节点须是选项构件，预设动作是让目标构件也被点选。   
这里，sPath 既可以是绝对路径，也可以是相对路径。

2. 用 `sPath,popConfig` 两个数组成员让目标节点弹出浮窗，目标节点要求是定义了 popOption 的选项构件，sPath 指示目标节点，popConfig 是弹窗的附加配置，触发弹窗时合并到目标节点的 popOption 使用，接下来马上有举例。

3. 用 `[sPath,modifier]` 更新任意目标节点的 `duals.data` 值，将在下一节详细介绍。

上面例子在 demo19 给出，请自行参考相关源码。`trigger` 属性定义一个 “可计算表达式”，其格式要求在后文 [可计算表达式](#2.5.) 介绍。

#### 传递 popOption 配置项

在 trigger 指定的预设动作列表中，如果某路径 sPath 之后跟一个配置字典 popConfig，表示将该 popConfig 一并传递给目标选项构件，如果目标构件定义了 popOption 属性，popConfig 将合并到 popOption。例如：

```
  <span :t=OptButton key='btn2' trigger='["//btn",{width:0.6}]'>trigger</span>
```

传递的配置 `{width:0.6}` 将叠加到目标节点的 `duals.popOption` 属性上，让弹出窗口的宽度变为 `60%` 屏宽。注意，叠加配置到 `duals.popOption` 后，`duals.popOption.path` 需有定义，否则，因为弹窗内容未指定，弹窗操作将被忽略。

#### 反复触发

由于选项构件在选中后 `data-checked` 属性置 `'1'`，之后再次点选此构件，trigger 预定义的动作自动被忽略。为了让 trigger 动作能多次触发，我们须用 `recheckable='{true}'` 指明，比如：

```
  <span :t=OptButton key='btn2' recheckable='{true}' trigger='["//btn"]'>trigger</span>
```

这样，连续多次点击按钮时，每次它都会触发 trigger 指定的动作。recheckable 是双源属性，它的缺省值为 `false`，表示 “不重复触发”。

#### 隔离选项构件

选项构件承担多种功能，包括：
1. 切换场景面板
2. 触发浮层弹窗
3. 连带触发由 trigger 指示的，若干选项构件的预设动作（切换场景面板或弹出浮窗）
4. 连带触发由 trigger 指示的，若干选项构件的双源属性（将在下一节详细介绍）

这 4 者中，后 3 者属于触发器应用。当选项构件用作触发器时，也称 “选项触发器”。

某些情况下，希望选项构件具有隔离功能，被隔离时，不能切换场景面板，但能触发在 `trigger` 定义的动作。此种 “隔离” 用双源属性 `isolated` 表示，其值为 `true` 表示当前处于隔离态，`false` 表示未被隔离，未隔离是缺省状态。

此外，可选构件所属的 “导航面板” 还支持通过定义 `canNavigateTo` 类方法，动态判断当前场景面板是否允许切换，详情请见 API 手册。

&nbsp;
