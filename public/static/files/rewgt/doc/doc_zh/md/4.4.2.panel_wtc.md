4.4.2 Panel 类构件
----------------

&nbsp;

> 基类定义：
> - [`Widget`](#4.4.2.!widget)
> - [`Unit`](#4.4.2.!unit)

> 根节点面板：
> - [`BodyPanel`](#4.4.2.!body_panel)

> 用于布局的面板：
> - [`Panel`](#4.4.2.!panel)
> - [`GridPanel`](#4.4.2.!grid_panel)
> - [`TablePanel`](#4.4.2.!table_panel)
> - [`GroundPanel`](#4.4.2.!ground_panel)
> - [`NavPanel`](#4.4.2.!nav_panel)

> 场景页：
> - [`ScenePage`](#4.4.2.!scene_page)

> 模板：
> - [`TempPanel`](#4.4.2.!temp_panel)

&nbsp;

##### <a name="widget"></a>`Widget`

> **`_statedProp` 新增定义：** `['width','height','left','top']`   
将属性定义到 `_statedProp`，便于可视化编辑中动态更新的值可被保存，比如面板控件的 `state.width` 可能被分割条经拖拉改变宽度，当控件导出时，自动以 `state.width` 取代 `props.width` 用于存盘。Shadow Widget 内置构件中，只有 `Widget` 与 `MarkedDiv` 使用了 `_statedProp` 定义。   
&nbsp;

> **`getDefaultProps()` 新增属性：**
> - `left: 0`
> - `top: 0`
> - `width: 0.9999`
> - `height: 0.9999`
> - `minWidth: 0`
> - `maxWidth: 0`
> - `minHeight: 0`
> - `maxHeight: 0`
> - `borderWidth: [0,0,0,0]`
> - `padding: [0,0,0,0]`
> - `margin: [0,0,0,0]`

> **新增 duals 属性：**
> - `keyid`   
此属性来源于传入的 key 值，如果传入 key 未定义，系统自动用 `0, 1, ...` 等数值表示。合法的传入 key 值限用 `"_  a~z A~Z 0~9"` 之中的字符，而且 key 值要避开 `parent component W getPath` 这几项命名（因为已用作 W 节点的内置属性或方法）。
> - `klass: ''`
> - `style: {}`
> - `left`
> - `top`
> - `width`
> - `height`
> - `minWidth`
> - `maxWidth`
> - `minHeight`
> - `maxHeight`
> - `borderWidth`
> - `padding`
> - `margin`
> - `id__: 0`
> - `childNumId: 0`
> - `trigger: undefined`

> **内部使用的 state 属性：**
> - `parentWidth`   
注：行内构件（Span 类）无此属性
> - `parentHeight`   
注：行内构件（Span 类）无此属性
> - `duals: []`   
用于记录 duals 属性延缓赋值
> - `exprAttrs: []`   
用于记录等待更新的可计算属性

&nbsp;

> **1) `defineDual(attr,setFn,initValue)`**

> 用于定义双源属性，`attr` 为属性名，`setFn` 为 setter 函数，`initValue` 为初始值，其中 `setFn` 与 `initValue` 参数可以缺省，setFn 缺省时系统将自动定义一个 setter 用于将新值赋给 `this.state.attr`，`initValue` 缺省时 `this.state.attr` 值为 `undefined`。

> 因为本函数返回当前 component 实例（即 `this`），所以可以将多条 `defineDual()` 语句串接起来书写，比如：

```
      this.defineDual('attr').defineDual('attr2');
```

> **2) `undefineDual(attr)`**

> 移除双源属性 `attr` 的定义。

> 如果继承类想重新定义 `attr` 的双源属性，通常先调用这个 `undefineDual(attr)`，然后再用 `defineDual()` 定义此属性。

> **3) `listen(attr,targComp,sMethod)`**

> 用于侦听双源属性。`attr` 指定被侦听的源属性，`targComp` 指定目标节点，`sMethod` 显式指定 `targComp` 下的类方法或另一个双源属性，此参数可缺省，缺省表示要登记的侦听函数命名将从源属性推导。若不缺省，如果 `targComp[sMethod]` 类方法存在，就登记该侦听函数，否则进一步判断`targComp.duals[sMethod]` 是否存在，如果存在就串接两个侦听源。

> 本函数返回 `listen` 函数所在的 component 实例，多条 `listen()` 语句串接起来书写。

> 只有双源属性可被侦听，被侦听的源属性可以只一个，还可以多个，如果参数 `attr` 为字串，表示侦听单项属性，如果 `attr` 为字串数组时，表示侦听多项属性，如果 `attr` 为 `{sAttr: sMethodName}` 格式时，表示侦听多项属性，并由 `sMethodName` 指定目标节点下的侦听函数名（其值须是有效函数名）。

> `listen()` 还用于直接登记侦听函数，当 `targComp` 参数是函数时，表示将它直接登记为侦听函数，而不必到目标节点下查找类方法。

> 从被侦听源属性推导侦听函数命名的规则是：添加 `"on"` 前缀并转换成 calmeCased 风格的命名，比如 `sourComp.listen('text',targComp)` 登记的侦名函数将是 `targComp.onText`。

> **4) `unlisten(attr,targComp,sMethod)`**

> 删除侦听项，它所带的各参数格式与 `listen(attr,targComp,sMethod)` 的要求相同，但增加 `attr` 的 `"*"` 通配符格式，`"*"` 表示删除源节点中指向目标节点（`targComp`）的所有侦听项，使用通配符时 `sMethod` 参数应缺省。

> 本函数返回 `unlisten` 函数所在的 component 实例，多条 `unlisten()` 语句串接起来书写。

> 说明：一个侦听项登记后，通常不必显式删除它，当登记的侦听源或目标节点失效后，侦听项会自动删除。

> **5) `getHtmlNode()`**

> 返回React Component 节点的真实 DOM 节点，等效于 `ReactDOM.findDOMNode(this)`。

> **6) `parentOf()`**

> 获取父节点 Component，如果失败（可能父节点不存在，或已 unmount）则返回 `null`。

> **7) `componentOf(sPath)`**

> 取 `sPath` 指示的 Componet 节点，`sPath` 既可以是绝对路径，也可以是相对路径。

> `sPath` 可以是如下形式的字串：

```
    ".body.p.btn"    /* 绝对路径 */
    "seg.subSeg"     /* 以本节点为基点，向下定位 */
    "//"             /* 取父节点，等同于调用  this.parentOf() */
    "//seg.subSeg"   /* 以父节点为基点，向下定位 */
    "./seg"          /* 以当前导航段为基点，向下定位 */
    "../seg"         /* 以上一个导航段为基点，向下定位 */
```

> **8) `elementOf(sPath)`**

> 取 `sPath` 指示的 Element 节点，`sPath` 既可以是绝对路径，也可以是相对路径，取值与 `componentOf(sPath)` 中的 `sPath` 要求相同。

> **9) `prevSibling()`**

> 取前一兄弟节点，如果不存在就返回 `undefined`。

> **10) `nextSibling()`**

> 取后一兄弟节点，如果不存在就返回 `undefined`。

> **11) `fullClone(props)`**

> 带 `props` 参数克隆当前节点，返回值 Element 的 `props` 由传入参数 `props` 与原有值合并而来，`props` 参数可缺省。

> 本函数与 `React.cloneElement()` 有差别，本函数对特定属性（如面板宽、高等）取当前使用值，而非 props 传入的值，另外还支持克隆模板构件中的子成员。

> 上面所提 “特定属性” 就是各节点 `_statedProp` 列出的属性，及所有 `data-*` 与 `aria-*` 属性。

> **12) `setChild(...)`**

> 设置子节点 Element，可以传入单个子节点，也可传多个。变长参数的最后一个若是 function 类型，表示它是回调函数，在本次设置完成后自动回调，回调函数带一个参数 `changed`（取值 `true` 或 `false` 表示是否对子成员产生修改）。

> 在被设置的子节点之前，还可以用命令字串限定操作。支持格式有：`'+key'` 与 `'-key'`，前者表示在键值为 key 的子节点之前插入，后者表示删除键值为 key 的子节点。

> 在参数传入的子节点，还可是 array 数组类型，表示批量增删，如 `this.setChild('+btn',[ele,ele2])` 表示在键值为 `btn` 的子节点之前插入 `ele` 与 `ele2` 节点。

> **13) `reRender(callback)`**

> 用于强制 render 刷新，刷新后 `callback` 回调函数将被调用，参数 `callback` 可以缺省。

> **14) `willResizing(width,height,inPending)`**

> 供父级是面板的构件专用，当父面板宽高变化时（即触发了 Resizing），调用本函数来决定当前节点是否按缺省方式响应父级宽高变化。`width` 与 `height` 是父构件宽高的像素值，`inPending` 指示当前父构件宽高尚在变化中（比如用鼠标拖拉分割条，拖拉未结束时，面板变宽高还在进行中）。

> 本方法用作回调服务，当 `willResizing` 未定义，或者定义了但调用它返回结果是 `true` 时，当前节点将按内置规则响应 Resizing 动作。反之，如果定义了 `willResizing` 且调用它返回为 `false` 时，表示不响应父级 Resizing，即，自身如何响应 Resizing 及如何向下传递已被接管。

##### <a name="unit"></a>`Unit`

> 本类继承自 [`Widget`](#4.4.2.!widget) ，描述通用的、非面板块级元素。

> **`getDefaultProps()` 新增属性：**
> - `className: 'rewgt-unit'`

> **新增 duals 属性：** 无。

##### <a name="body_panel"></a>`BodyPanel`

> 本类继承自 [`Widget`](#4.4.2.!widget)，描述根节点面板 。

> **`getDefaultProps()` 新增属性：** 无。

> **新增 duals 属性：**
> - `innerSize`   
`innerSize` 初始值记录了当前 Web 页内容区宽高，等效于 `[window.innerWidth,window.innerHeight]`。

##### <a name="panel"></a>`Panel`

> 本类继承自 [`Widget`](#4.4.2.!widget) ，提供用于 flex 布局的面板。

> **`getDefaultProps()` 新增属性：**
> - `className: 'rewgt-panel'`

> 新增 duals 属性：无。

&nbsp;

> **1) `isRow()`**

> 用于判断当前面板为横向布局面板，还是纵向布局面板，返回 `true` 表是横向布局，否则是纵向的。

> **2) `isReverse()`**

> 用于判断当前面板是否反向排序，返回 `true` 表示反向排列。对于横向布局反向是指从右向左排列，对于纵向布局是指从下向上排列。

##### <a name="grid_panel"></a>`GridPanel`

> 本类继承自 [`Panel`](#4.4.2.!panel) ，提供可预定义列数与列宽的面板。

> **`getDefaultProps()` 新增属性：**
> - `cellSpacing: undefined`
> - `sizes: [0.3,0.3,-1]`

> **新增 duals 属性：**
> - `cellSpacing`   
> 指定各列之间间隙的像素值，缺省为 0 像素。GridPanel 下各个子面板因 margin 取值缺省为0，子面板之间的间隙为 0，当用户修改子面板的 margin 值时，应同时调整本属性的值，以便让 GridPanel 仍能正确计算其下子面板处于哪行哪列。
> - `sizes`   
> 指定各列占宽，各项取值大于 0 且小于 1 时表示百分比，大于等于 1 时为像素值，负值表示剩余宽的百分比。

##### <a name="table_panel"></a>`TablePanel`

> 本类继承自 [`Panel`](#4.4.2.!panel) ，描述表格化的面板控件。

> **`getDefaultProps()` 新增属性：**
> - `className: 'rewgt-unit rewgt-table'`
> - `height: null`

> **新增 duals 属性：** 无。

##### <a name="table_row"></a>`TableRow`

> 本类继承自 [`Unit`](#4.4.2.!unit) ，与 TablePanel 中使用，用来描述表格内单行内容。

> **`getDefaultProps()` 新增属性：**
> - `height: null`

> **新增 duals 属性：** 无。

##### <a name="ground_panel"></a>`GroundPanel`

> 本类继承自 [`Panel`](#4.4.2.!panel) ，在导航段下用作场景面板。

> **`getDefaultProps()` 新增属性：**
> - `height: null`
> - `minHeight: 20`

> **新增 duals 属性：** 无。

##### <a name="nav_panel"></a>`NavPanel`

> 本类继承自 [`Panel`](#4.4.2.!panel) ，用作导航面板。

> **`getDefaultProps()` 新增属性：** 无。

> **新增 duals 属性：** 无。

&nbsp;

> **1) `setChecked(key,callback)`**

> 切换场景面板，参数 `key` 指示目标页，`callback` 为切换后的回调函数。

> **2) `getChecked()`**

> 查询当前场景面板的键值。

> **3) `fireChecked(key,callback)`**

> 触发切换到 `key` 场景面板，`callback` 为切换后的回调函数。

> **4) `canNavigateTo(key)`**

> 用于判断是否可以切换到 `key` 场景面板，本方法用作回调服务，可以不定义，未定义时表示对场景面板是否可切换不作限制。如果本方法定义了，且调用的返回结果是 `false` 时，表示不允许切换到 `key` 场景面板。

##### <a name="scene_page"></a>`ScenePage`

> 本类继承自 [`Panel`](#4.4.2.!panel) ，用作场景页。

> **`getDefaultProps()` 新增属性：**
> - `className: 'rewgt-panel rewgt-scene'`

> **新增 duals 属性：** 无。

##### <a name="temp_panel"></a>`TempPanel`

> 本类继承自 [`Panel`](#4.4.2.!panel) ，提供 Panel 类模板。

> **`getDefaultProps()` 新增属性：** 无。

> **新增 duals 属性：** 无。

<div class="rewgt-mdref" path=".rewgt.book_top"></div>

&nbsp;
