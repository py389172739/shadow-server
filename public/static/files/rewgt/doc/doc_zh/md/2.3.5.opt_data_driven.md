2.3.5 选项构件的数据驱动
---------------------------

&nbsp;

#### 用 trigger 驱动双源属性

在 trigger 预设触发动作，如果指定 `[sPath,modifier]`，表示找到 sPath 指示的目标构件，得到它的 `duals.data` 属性，然后用 `ex.update(duals.data,modifier)` 更新 `duals.data` 值。
 
举例如下：

```
  <div :t=Panel key='top'>
    <div :t=NavPanel key='nav' width='{0.9999}' height='{200}'>
      <div :t=P key='opt'>
        <span :t=Span key='txt' dual-data='{["text",0]}'>example </span>
        <span :t=OptButton key='trigger' recheckable='1' 
              trigger='[["//txt",{$set:["new text",ex.time()]}]]'>trigger</span>
      </div>
    </div>
  </div>
```

这个例子中，`trigger='[["//txt",{$set:["new text",ex.time()]}]]` 定义待触发的动作，`"//txt"` 指示目标节点，找到目标节点的 `duals.data`，之后的动作相当于执行下面语句：

```
    duals.data = ex.update(duals.data,{$set:["new text",ex.time()]});
```

触发动作后，我们在浏览器的控制台中，运行脚本 `comp = W.W('.body.top.nav.opt.txt').component` 得到目标节点，再运行 `comp.duals.data` 可检查赋值有没成功。

注意：
1. 可给任意目标节点的 `duals.data` 赋值，并不限于选项构件，但限定给双源属性 `data` 赋值。
2. 一个 trigger 表达式中，可给多个目标节点的 `duals.data` 赋值，依次罗列多份 `[sPath,modifier]` 即可。
3. `[sPath,modifier]` 中的 sPath 可以是空字串，表示 trigger 表达式所在的节点。
4. 触发弹窗与触发 `duals.data`，在 trigger 表达式中可同时使用。

#### 非选项构件也支持 trigger 属性

非选项构件也支持 trigger 双源属性，但只当结果数组的成员是 `[sPath,modifier]` 格式时才有效。对各成员项，同样用 sPath 找目标节点的 `duals.data`，再执行 `duals.data = ex.updata(duals.data,modifier)`。

#### 侦听 data-checked 变化

选项构件的 `data-checked` 是双源属性，其值变化可被侦听，例如：

```
  main['.body.top.nav.btn.a'] = {
    componentDidMount: function() {
      this._componentDidMount(this);
      
      this.listen('data-checked', function(value,oldValue) {
        console.log('data-checked =',value);
      });
    },
  };
```

通过侦听 `data-checked` 值变化，我们捕获选项构件的状态变迁事件，以此组织单向数据流动的响应式开发系统。

`trigger` 表达式支持复杂的运算，比方，取得任意节点的 `props.attr` 或 `state.attr` 值，使用常规运算（如加减乘除，组装字串，列表查找、过滤等）。让我们不必借助编程，只用转义标签就能构造强大功能。

比如，在 trigger 表达式中调用 `ex.log()`，向控制台输出特定信息（这常用作调试）：

```
  <span :t=OptButton key='test' recheckable='{true}' 
        trigger='[["//test",{$set:ex.log("clicked")}]]'>Test</span>
```

本节举例用到的代码在 demo20。

#### 选项构件与导航面板、场景面板的对应关系

选项构件只在导航面板中才表现正常功能，您不应该将选项构件放在 NavPanel 或 NavDiv 之外使用。如果一定要在 NavPanel 或 NavDiv 之外使用，应设定该选项构件的 `isolated` 值为 `true`，处于隔离态，让它不必响应切换场景面板的操作。

当选项构件用于切换场景面板时，有多少个场景面板，就应设置多少个选项构件，两者用 key 实现关联，但同一场景面板由多个选项构件（其 key 相同）点选出来也是允许的，也就是说，同一场景面板可被多个页标签召唤出来。

在导航面板下，还可不定义场景面板，因为选项构件不只用来切换场景面板，它也用作 “选项触发器”，比如用来触发浮层弹窗，或驱动某节点的 `duals.data` 变化，就没必要非在当前导航面板中定义场景面板。

一个导航面板形成一截 “段路径”，段内各节点的引用可用相对路径，其定位方式与外界（指当前导航段之外）无关，相对独立。所以，如果多采用导航面板组织 UI 各大功能块，对提高程序可移植性与可维护性有利。

&nbsp;
