3.4.5 协调两种编程风格
------------------------

&nbsp;

#### 从 MVC 到 MVVM 框架

如 React 官方宣传的那样，原生 React 提供了虚拟 DOM，可视作 MVC 框架中的 View，但由于 JSX 描述虚拟 DOM，内嵌于 javascript 代码中，导致它的 View 并不独立，界面呈现与业务实现纠缠一起，给编码与维护带来很大困扰。

![MVC framework](md/res/mvc.jpg)

Shadow Widget 提供 W 树、双源驱动、可计算属性等机制，MVC 框架因此顺利演进到 MVVM（Model-View-ViewModel）。

![MVVM framework](md/res/mvvm.jpg)

在 MVVM 框架中，3 种逻辑处理得到良好分离：
1. 界面逻辑（UI Logic），由 View 处理，也就是我们用转义标签描述的那部分。
2. 展现逻辑（Presentation Logic），由 ViewModel（即 VM）处理，投影定义是 VM，前面介绍 `$id__` 的 setter 函数等效于投影定义，也可用作 VM。
3. 业务逻辑（Business Logic），由 Model 处理，创建 VM 传入的 props 数据，或在 `componentDidMount()` 时发送请求获得的 json 数据，都属于 Model。   
说明：Model 是满足业务需求的数据模型，对于简单应用，Model 缩减为几项平白数据，但对于复杂应用，宜独立封装出类似 DataCenter 的实体，集中处理数据间的业务逻辑，提供查询、存贮、转换等功能。

#### 跨越 “选择困难”

由于 Shadow Widget 同时适应 **“函数式”** 风格编程与 **“指令式”** 编程，前者 React 技术圈的原生形态，后者是 Angular 与 Vue 的主体开发形态。当多种开发模式兼存并蓄，容易给大家带来选择困难，下面尝试从几个角度提供建议，帮助大家选择最佳方式。

**首先，您应确定需不需要自行开发 WTC 类**。开发新的 WTC 类要从已有 WTC 类继承，但选择已有 WTC 类后，叠加投影定义（或用 idSetter 定义）也通常能达到预定目标，这两者的区别仅在于：自行定义 WTC 类后，可以再次被继承，即，前者常用来开发可重用组件库，后者则直接面向终端功能，投影定义（或 idSetter 定义）无法按继承方式实现重用。

如果满足下面两种情况，您应自行开发 WTC 类：
1. 产品的交付件包含了自己开发的组件库，专供给他人用于二次开发
2. 虽不对外发布组件库，但产品底层需封装公用库，供多人使用、反复重用，即，为自身开发的便利性考虑，要封装一些 WTC 类。

**然后，分析被开发的功能属逻辑简单的，还是逻辑复杂的**。如果逻辑简单、编程很容易驾驭的，首选指令式风格，即：用转义标签描述界面，在上层做开发，主体开发工作是在 main 模块编写投影定义（或 idSetter 定义）。如果遇到逻辑复杂的，且编码工作量大的，才考虑移到下层做开发，创建 browserify 或 webpack 工程环境，用 ES6 编码经 babel 转译成 ES5。即便如此，仍须将复杂部分拎取出来，集中处理，尽量分离出逻辑简单的模块，用指令式开发来解决。

综合来看，基于 Shadow Widget 的开发，会遭遇 3 类开发任务：

1. 在上层 main 模块中，用 ES5 编写投影定义（或 idSetter 定义），界面设计在可视化设计器（参见 [可视化设计手册](#5.)）中完成。
2. 在下层开发投影定义 ，局部界面用 JSX 描述
3. 在下层开发 WTC 构件类

上层开发与下层开发既可以二选一，也可以两者同时采用。

#### 如何拎取复杂的界面处理

方法一，将复杂的处理拎取到一个网页集中处理

Shadow Widget 以网页为单位做开发，一个网页一个工程，尽管多个网页可以用 iframe 方式嵌入，多个网页可以聚合起来使用，但一次 Shadow Widget 工程开发，只关心单个网页的程序如何加载，如何运行。

将复杂处理拎到一个网页集中开发，然后用 iframe 把嵌入到其它独立开发的模块的，整体上能让编程变简单。

方法二，采用 “库化UI”，把若干可重用的界面定义为模板（TempPanel、TempDiv、TempSpan），挂到 W 树的 `body` 节点下。使用时，只需引用相应模板，喂给它特定格式的数据，就创建出特定的用户界面了。

 “库化UI” 宜以函数式风格开发，并以 javascript 脚本文件发布，使用时只须将该脚本文件用 `<script>` 标签引入到当前网页。如何开发 “库化UI” 请参考 [定制扩展](#3.6.) 。

某些复杂的界面不方便拎取到独立网页，或不方便用 iframe 引用时，宜采用 “库化UI” 方式。

&nbsp;

上述两种方法，正是让 “函数式编程” 与 “指令式编程” 协调共处的有效途径。采用函数式风格编程，输出独立网页或 “库化UI”，来供指令式编程使用。这两种风格尽量明显区隔，不宜在细碎环节，将函数式与指令式风格揉合一起同时使用。

&nbsp;
